!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.dmmma?define(["exports"],e):e((t=t||self).tracertUtil={})}(this,(function(t){"use strict";function e(t,e,n){var r=e||window.document;r.addEventListener?r.addEventListener(t,n,!0):r.attachEvent?r.attachEvent("on".concat(t),n):r[t]=n}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}function s(t){"interactive"===document.readyState||"complete"===document.readyState?t():e("DOMContentLoaded",document,t)}function l(t){return"requestIdleCallback"in window?l(t):setTimeout(t)}function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n={};for(var r in t)if(t.hasOwnProperty(r)){var o=0===r.indexOf(e)?r:e+r;n[o]=t[r]}return n}function f(t,e){var n=t||{};for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(n[r]=e[r]);return n}function p(t,e){var n="";try{n=RegExp("(?=\\?|\\&|\\b|^)".concat(t,"\\=(.+?)(?=\\&|$)")).exec(e),n=decodeURIComponent(n=n?"".concat(n[1]):"")}catch(t){console.warn(t)}return n}function m(t){var e=window.AlipayJSBridge;return e&&e.startupParams&&e.startupParams[t]}function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:location.search;if(!t)return"";var n="";return""===(n=p(t,e))&&(n=m(t)),n}function v(t){var e=t||window.navigator.userAgent;if(!RegExp("aliapp\\(".concat("ap"),"i").test(e))return 0;var n=/alipayclient\/(\d+)\.?(\d+)?\.?(\d+)?/i.exec(e),r=0;if(n){var o=n[1]||0,a=n[2]||0,i=n[3]||0;10>+a&&(a="0".concat(a)),10>+i&&(i="0".concat(i)),r=parseFloat("".concat(o,".").concat(a).concat(i))}return r}function h(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"^",r=[];if(t instanceof Array)r=t;else if(t instanceof Object)for(e in t)t.hasOwnProperty(e)&&r.push("".concat(e,"=").concat(t[e]));return r.join(n)}function y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"^";if("string"!=typeof t)return null;var n=t.split(e);if(-1===t.indexOf("="))return n;for(var r,o,a=n.length,i={},c=0;a>c;c++)(r=n[c])&&(i[(o=r.split("="))[0]]=o[1]||"");return i}var w=f,x=h;var b=/^a|area$/i;function S(t){var e,n;try{return e=[].slice.call(t)}catch(o){e=[],n=t.length;for(var r=0;n>r;r++)e.push(t[r]);return e}}function A(t,e){return t&&t.getAttribute&&t.getAttribute(e)||""}function I(t){return null!==t&&"object"===n(t)&&1===t.nodeType}function O(t){return!(!t||!I(t)||t===document.body||t===document.documentElement)}function C(t){var e=t;if(!O(e))return"null";do{if(b.test(e.tagName)||e.hasAttribute("data-aspm-click"))return e}while((e=e.parentNode)&&e&&e.tagName&&"BODY"!==e.tagName&&e!==document.body&&!A(e,"data-aspm"));return null}function E(t){return t?encodeURIComponent(t).replace(/'/g,"%27"):t}function T(t,e,n){if(t)try{var r=new XMLHttpRequest;r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(n?"data=".concat(E(e.join()),"&time=").concat((new Date).getTime(),"&taskId=").concat(n):"data=".concat(E(e.join()),"&time=").concat((new Date).getTime()))}catch(r){try{var o=new Image;o.src=n?"".concat(t,"?data=").concat(E(e.join()),"&time=").concat((new Date).getTime(),"&taskId=").concat(n):"".concat(t,"?data=").concat(E(e.join()),"&time=").concat((new Date).getTime())}catch(t){console&&console.warn&&console.warn("[Tracker]",t)}}else console&&console.warn&&console.warn("请配置Tracert服务接收地址")}function j(t,e){window&&window.AlipayJSBridge?window.AlipayJSBridge.call(e,t):console&&console.warn&&console.warn("[Tracert]AlipayJSBridge is Empty")}function k(){for(var t=0,e={};arguments.length>t;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var P=function t(e){function n(t,r,o){var a;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(o=k({path:"/"},n.defaults,o)).expires){var i=new Date;i.setMilliseconds(i.getMilliseconds()+864e5*o.expires),o.expires=i}o.expires=o.expires?o.expires.toUTCString():"";try{a=JSON.stringify(r),/^[\{\[]/.test(a)&&(r=a)}catch(t){}r=e.write?e.write(r,t):encodeURIComponent(r+"").replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(t+"")).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var c="";for(var u in o)o[u]&&(c+="; "+u,!0!==o[u]&&(c+="="+o[u]));return document.cookie=t+"="+r+c}t||(a={});for(var s=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,d=0;s.length>d;d++){var f=s[d].split("="),p=f.slice(1).join("=");this.json||'"'!==p.charAt(0)||(p=p.slice(1,-1));try{var m=f[0].replace(l,decodeURIComponent);if(p=e.read?e.read(p,m):e(p,m)||p.replace(l,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(t){}if(t===m){a=p;break}t||(a[m]=p)}catch(t){}}return a}}return n.set=n,n.get=function(t){return n.call(n,t)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,e){n(t,"",k(e,{expires:-1}))},n.withConverter=t,n}((function(){}));function _(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=window.localStorage&&window.localStorage.getItem(t)||P.get(t,e);if(P.get(t,e)&&window.localStorage)try{window.localStorage.setItem(t,n),P.remove(t,e)}catch(t){console&&console.warn&&console.warn("localstorage error")}return n}function R(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||400>e.length||!n.cookie&&window.localStorage)if(window.localStorage)try{window.localStorage.setItem(t,e)}catch(r){P.set(t,e,n)}else P.set(t,e,n);else console&&console.warn&&console.warn("Tracert cookie set too long")}function B(t,e){window.localStorage&&window.localStorage.removeItem(t),P.remove(t,e)}var D=new(function(){function t(){r(this,t)}return a(t,[{key:"set",value:function(){var t=[].slice.call(arguments);2>t.length?this._set(t):this._set(i({},t[0],t[1]),t[2]||{})}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="".concat("_TRACERT_COOKIE_","_").concat(t),o=_(r,e);return n&&B(r),o}},{key:"_set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&0!==Object.keys(t).length)for(var n in t)if(t.hasOwnProperty(n)){var r="".concat("_TRACERT_COOKIE_","_").concat(n);R(r,t[n],e)}}}]),t}());var M={parse:function(t){var e=t.split("//"),n=e[0],r=e[1]||"",o=r.split("/")[0],a=o.split(":"),i=a[0],c=a[1]||"",u=r.replace(o,"").split("#"),s=u[0],l=u[1]||"",d=l?"#".concat(l):null,f=s.split("?"),p=f[0],m=f[1]||"",g={protocol:n,slashes:!0,auth:null,host:o,port:c||null,hostname:i,hash:d,search:m?"?".concat(m):null,query:m||null,pathname:p,path:s,href:t,format:function(){return"".concat(g.protocol,"//").concat(g.host).concat(g.path).concat(g.hash||"")}};return g}},N=new(function(){function t(){r(this,t),this._iframe=null}return a(t,[{key:"initIframe",value:function(){if(this._iframe)return this._iframe;var t=document.createElement("iframe");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.left="-100px",t.style.bottom="-100px",t.style.width="-100px",t.setAttribute("src","https://tracert.alipay.com/cross.html"),t.onload=function(){t.style.display="none"};try{document.body.appendChild(t)}catch(t){}return this._iframe=t,t}}]),t}());t.Cookies=P,t.CrossIframe=N,t.addEvent=e,t.addMexOption=function(t,e){var n=t||{},r=e||{};if(!r.spmId||"mergeExpose"!==r.actionId)return n;if(3===r.spmId.split(".").length){var o=r.spmId;n[o]||(n[o]={},n[o]=w({},r))}return n},t.addToExObj=function(t,e){var n=t||{},r=e||{};if(!r.spmId||"mergeExpose"!==r.actionId)return null;if(3===r.spmId.split(".").length){var o=r.spmId;n[o]||(n[o]={});var a="";r.param4&&r.param4.rid?(a=r.param4.rid,delete r.param4.rid):a="",n[o][a]||(n[o][a]=[]),n[o][a].push(r.param4)}return n},t.cookiesPrefix="_TRACERT_COOKIE_",t.dealExtra=d,t.debounce=function(t,e){var n,r=arguments,o=this;return function(){var a=o,i=r;clearTimeout(n),n=setTimeout((function(){n=null,t.apply(a,i)}),e)}},t.formatExObj=function(t,e){var r=[],o=["fullURL","mBizScenario","mPageState","mPageName","version"];if("object"===n(t))for(var a in t)if(t.hasOwnProperty(a)){var i={};e?i=w(i,e[a]):(i.spmId=a,i.actionId="mergeExpose");var c=[];if(t[a].options)i.param4=x(t[a].options.param4);else{for(var u in t[a])if(t[a].hasOwnProperty(u)){for(var s=[],l=t[a][u],d=0;l.length>d;d++){var f=[],p=l[d];for(var m in p)p.hasOwnProperty(m)&&-1===o.indexOf(m)&&f.push("".concat(m,"|").concat(p[m]));s.push(f.join(";"))}c.push("rid|".concat(u,":").concat(s.join("&")))}i.param4="exposed=".concat(c.join("__"))}r.push(i)}return r},t.getApFloatVersion=v,t.getAttr=A,t.getContentParam=function(t){if(!(!(!t||!t.hasAttribute)&&t.hasAttribute("data-aspm-content")))return{};var e=t&&t.getAttribute&&t.getAttribute("data-anewChinfo")||"",n=t&&t.getAttribute&&t.getAttribute("data-ascm")||"";return{param5:"newChinfo=".concat(e,"^scm=").concat(n)}},t.getDPosDom=C,t.getDomParam=function(t){var e=t&&t.getAttribute&&t.getAttribute("data-aspm-param")||"",n={};if(e){var r=e.split("^");if(-1===e.indexOf("="))n=r;else for(var o,a,i=r.length,c=0;i>c;c++)(o=r[c])&&(n[(a=o.split("="))[0]]=a[1]||"")}return n},t.getMetaPageName=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pagename",e=S(window.document.getElementsByTagName("meta")),n="",r=0;e.length>r;r++){var o=e[r],a=A(o,"name"),i=A(o,"content");if(i&&a&&a===t){n=i;break}}return n},t.getMetaSpm=function(t){for(var e,n,r,o,a,i=S(t||document.getElementsByTagName("meta")),c=i.length,u=0;c>u;u++){switch(n=A(e=i[u],"name"),r=A(e,"content"),n){case"data-aspm":a=r;break;case"data-bizType":o=r}if(a&&o)break}var s={};return a&&(s.spmAPos=a),o&&(s.bizType=o),s},t.getPageMaxZindex=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=c(document.all).map((function(t){return+window.getComputedStyle(t).zIndex||0}));return e.length?Math.max.apply(Math,c(e)):t},t.getSpmBPos=function(){return A(document.body,"data-aspm")},t.getSpmCPos=function(t){var e=t;if(!O(e))return"";for(var n="";e&&e!==document.body&&!(n=A(e,"data-aspm"));)e=e.parentNode;return n},t.getSpmDPos=function(t){var e=t;if(!O(e))return"";if(b.test(e.tagName)||e.hasAttribute("data-aspm-click")||(e=C(e)),!e)return"";var n=A(e,"data-aspm-click"),r=e.tagName;if(("string"==typeof n||b.test(r))&&!n){var o=0,a=e;do{I(a)&&r===a.tagName&&o++,a=a.previousSibling}while(a);n=o}return"".concat(n)},t.getValue=g,t.getValueFromSearch=p,t.getValueFromStartupParams=m,t.inIframe=function(){try{return window.self!==window.top}catch(t){return!0}},t.isDom=I,t.isViewDom=O,t.isWechat=function(){return"undefined"!=typeof WeixinJSBridge||"undefined"!=typeof QQJSBridge||!(!window.navigator||!(window.navigator.userAgent.toLowerCase().indexOf("micromessenger")>-1||window.navigator.userAgent.toLowerCase().indexOf("qq")>-1||window.navigator.userAgent.toLowerCase().indexOf("toutiaomicroapp")>-1||void 0!==window.navigator.wxuserAgent))},t.load=s,t.nodeListToArray=S,t.objToStr=h,t.objectAssign=f,t.removeEvent=function(t,e,n){var r=e||window.document;r.removeEventListener?r.removeEventListener(t,n,!0):r.detachEvent?r.detachEvent("on".concat(t),n):r[t]=n},t.request=function(t){var e=t.tracert,n=t.type,r=t.data,o=t.jsApiType,a=void 0===o?"remoteLog":o,i=e.server,c=e.taskId,u=e.verifyServer;switch(e.debug&&console&&console.log&&console.log(r),n){case"http":T(i,r),c&&u&&T(u,r,c);break;case"AlipayJSBridge":j(r,a);break;default:T(i,r)}},t.requestIdleCallback=l,t.sendAlipayJSBridge=j,t.sendHttpRequest=T,t.spmDPosMarkAttr="data-aspm-click",t.spmDataKey="data-aspm",t.storage=D,t.strToObj=y,t.url=M,t.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},t.visibleProportion=function(t,e){var n=e||t.getBoundingClientRect(),r=document.documentElement.clientHeight,o=Math.min(r,Math.max(n.top,0));return(Math.max(0,Math.min(n.top+n.height,r))-o)/n.height||1},Object.defineProperty(t,"__esModule",{value:!0})}));
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],t):(e=e||self).tracertCore=t(e.tracertUtil)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e){return function(e){if(Array.isArray(e))return e}(e)||l(e)||u(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return d(e)}(e)||l(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function u(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}var f=function(e){console&&console.warn&&console.warn("Tracert deprecated：".concat(e))},p=document;return function(){function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,o);var r={autoLogPv:!0,eventType:"click",autoExpo:!1,bizType:"H5behavior",state:"",name:"",logLevel:"2",mdata:{},seedIdPrefix:"",seedIdSuffix:"",spmAPos:"",spmBPos:"",bizScenario:e.getValue("bizScenario")||"",paramPrefix:"",debug:!1,server:"",taskId:"",verifyServer:"",lastClkSpm:"",url:location.href.split(/\?|#|;jsessionid=/)[0],referSPM:"",srcSpm:"",sessionIdKey:"tracert-session-key",seedIdCfg:{pageSeedId:"H5_MTRACKER_AP_PAGE",clkSeedId:"H5_MTRACKER_AP_CLK",calcSeedId:"H5_MTRACKER_AP_CALC",expoSeedId:"H5_MTRACKER_AP_EXPO",syslogSeedId:"H5_MTRACKER_AP_SYSLOG"},_plugins:[],platformType:"",ready:!1,apiCashList:[],timeMap:{},expoOnce:!1,_wap_intervalEx:400,_wap_interval:300,_wap_mgObjIndex:0,_wap_exObjIndex:0,_wap_mgTdObjIndex:0,_expoMergeItvObj:0,hasExpoMerge:!1,fmtedExObjArr:[],fmtedExObj:{},fmtedExOptions:{},cacheExObjArr:[],cacheMrExObjArr:[],expotTimeout:300,expoObj:{},expoType:function(t){var n=!1;e.addEvent("scroll",p,(function r(){n||(n=!0,e.removeEvent("scroll",p,r),setTimeout((function(){n=!1,e.addEvent("scroll",p,r)}),300),t())}))},expoSection:[-.3,.3],_beforeEvObj:{logPv:[],click:[],expo:[],set:[],send:[]},_afterEvObj:{start:[],logPv:[],click:[],expo:[]},_pluginLoadCnt:0,sysInfo:{}};e.objectAssign(r,t),e.objectAssign(this,r);var a=window.TracertCmdCache;if(a&&a.length)for(var i=0;a.length>i;i++){var l=[].slice.call(a[i]),u=s(l),d=u[0],f=u.slice(1);this.call.apply(this,[d].concat(c(f)))}this._start()}var a,l,u;return a=o,(l=[{key:"before",value:function(e,t){var n=this._beforeEvObj;if(!n[e])throw Error("目标方法不支持该事件");if("function"!=typeof t)throw Error("监听器不是函数");n[e].push(t)}},{key:"_runBeforeFns",value:function(e,t){var n=this._beforeEvObj[e]||[];if(!n||!n.length)return!0;for(var r=0;n.length>r;r++)if(!1===n[r].call(this,t))return console&&console.debug&&console.debug("Tracert before fns: ".concat(e," stop propagation")),!1;return!0}},{key:"after",value:function(e,t){var n=this._afterEvObj;if(!n[e])throw Error("目标方法不支持该事件");if("function"!=typeof t)throw Error("监听器不是函数");"start"===e&&this.ready?t():n[e].push(t)}},{key:"_runAfterFns",value:function(e,t){var n=this._afterEvObj[e]||[];if(n&&n.length)for(var r=0;n.length>r;r++)n[r].call(this,t)}},{key:"init",value:function(){}},{key:"load",value:function(t){e.load(t)}},{key:"onReady",value:function(e){this.ready?e&&e():document.addEventListener("TracertOnReady",(function(){e&&e()}))}},{key:"_start",value:function(){var t=this,n=function(){t.load((function(){if(!t.ready){var n=e.getMetaSpm();n.spmAPos=t.spmAPos||n.spmAPos,t.spmBPos||(n.spmBPos=e.getSpmBPos()),t.set(n),t.ready=!0;for(var r=0;t.apiCashList.length>r;r++)t.call.apply(t,t.apiCashList[r]);t._runAfterFns("start"),t.apiCashList=[]}}))};this.pluginReady&&this.started?n():(document.addEventListener("TracertPluginReady",(function(){t.started&&n()})),document.addEventListener("TracertStart",(function(){t.pluginReady&&n()})))}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.run(e)}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.set(i(i({},e),{},{started:!0}));var t=document.createEvent("HTMLEvents");t.initEvent("TracertStart",!0,!0),document.dispatchEvent(t),this.autoLogPv&&this.call("logPv")}},{key:"loadPlugins",value:function(e){if(e&&e.length){this._plugins=e;for(var t=0;e.length>t;t++)this.loadPlugin(e[t])}}},{key:"loadPlugin",value:function(e){var t=this;e&&(window["tracert".concat(e)]&&"function"==typeof window["tracert".concat(e)]||"function"==typeof e)&&("function"==typeof e?e:window["tracert".concat(e)])(this,(function(){if(t._pluginLoadCnt++,t._pluginLoadCnt===t._plugins.length){t.set({pluginReady:!0});var e=document.createEvent("HTMLEvents");e.initEvent("TracertPluginReady",!0,!0),document.dispatchEvent(e)}}))}},{key:"call",value:function(){var e,t=[].slice.call(arguments);if(!t[0]||"run"!==t[0]&&"start"!==t[0]||this.set({started:!0}),this.ready){if(!this[t[0]]||"function"!=typeof this[t[0]])return console.warn("未找到方法：".concat(t[0])),null;var n=t.slice(1);n=this.optionsHandle(n),e=this[t[0]].apply(this,n)}else this.apiCashList.push(t);return e}},{key:"optionsHandle",value:function(e){return e&&e.length?(e.forEach((function(e){var t=e;t&&(t.spmid&&(t.spmId=t.spmid),t.seedid&&(t.seedId=t.seedid),t.ucid&&(t.ucId=t.ucid))})),e):e}},{key:"get",value:function(e){return this[e]}},{key:"set",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n;this._runBeforeFns("set",r),r.eventName&&e.objectAssign(r,{eventType:r.eventName}),"object"===t(r.mdata)&&(r.mdata=i(i({},this.mdata),r.mdata)),e.objectAssign(this,r)}},{key:"getSysInfo",value:function(e){return this.sysInfo[e]}},{key:"setSysInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t;e.objectAssign(this.sysInfo,n)}},{key:"config",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f("请使用 set 方法"),this.set(e)}},{key:"remoteLog",value:function(){}},{key:"logPv",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._runBeforeFns("logPv",e);t&&(this._logPv(e),this._runAfterFns("logPv",e))}},{key:"_logPv",value:function(){}},{key:"report",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.params,r=e.spmId;if(r){var o=r.split("."),a=o[0],s=o[1];a&&s&&this.set({spmAPos:a,spmBPos:s})}"object"===t(n)&&this.set({mdata:i(i({},this.mdata),n)}),this.set({_calledLogPv:!!r}),this.call("logPv")}},{key:"pageState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.set({state:e}),this.call("logPv")}},{key:"pageName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";f("已废弃"),this.set({name:e})}},{key:"setPageState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.call("pageState",e)}},{key:"time",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="".concat(e),n=this.timeMap;t&&!n[t]&&(n[t]=new Date-0)}},{key:"timeEnd",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="".concat(e),n=this.timeMap;if(!t||!n[t])return"";var r=n[t],o=new Date-0-r;return delete n[t],o}},{key:"_goRemotelog",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n.seedId||n.spmId){var r=n.spmId||n.spmid||"",o=r.split("."),a=o.length,i=this.spmAPos,s=this.spmBPos;if(i&&s)switch(a){case 1:case 2:if(""===r)break;if(0!==r.indexOf("c"))break;r=[i,s,r].join(".")}var c={ucId:n.ucId,seedId:n.seedId,spmId:r,actionId:n.actionId,logLevel:n.logLevel||this.logLevel,param4:n.mdata||{}};if(n.type&&(c.type=n.type),n.params&&"object"===t(n.params))if(n.params.length)e.objectAssign(c,{param1:n.params[0]||"",param2:n.params[1]||"",param3:n.params[2]||""});else{var l=n.mdata||{};e.objectAssign(l,n.params),e.objectAssign(c.param4,l)}if(n.timeKey){var u=this.call("timeEnd",n.timeKey);u&&(c.param4.consume=u)}this.call("remoteLog",c)}else console.warn("请填入埋点seedId或spmId")}},{key:"info",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._goRemotelog(e)}},{key:"error",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.objectAssign(t,{type:"error",actionId:"exception"}),this._goRemotelog(t)}},{key:"click",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={spmId:n,extra:r,options:o},s=this._runBeforeFns("click",a);if(s){var c=r.extraSpmIds;a.extra.extraSpmIds&&delete a.extra.extraSpmIds;var l=a.spmId.split(":"),u=l[1]?{seedDesc:l[1]}:{};e.objectAssign(u,e.dealExtra(a.extra,this.paramPrefix));var d={param1:this.url,param2:l[0],param4:u,seedId:this.seedIdCfg.clkSeedId,actionId:"clicked",spmId:l[0]};if(this.fullLinkAndChInfo){var f=a.extra.newChinfo||"",p=a.extra.entityId||a.extra.scm||"";if(f&&p){var v={param5:"newChinfo=".concat(f,"^scm=").concat(p)};e.objectAssign(d,v),e.objectAssign(a.options,v)}}e.objectAssign(d,a.options),this.set({lastClkSpm:a.spmId}),this.call("remoteLog",i({},d),!0),c&&c.length&&c.forEach((function(e){t.call("remoteLog",i(i({},d),{},{extraPageId:e}),!0)})),this._runAfterFns("click",a)}}},{key:"expo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"up",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={spmId:t,offset:n,extra:r,options:o},i=this._runBeforeFns("expo",a);if(i){var s={param1:this.url,param2:a.spmId,param3:a.offset,param4:e.dealExtra(a.extra,this.paramPrefix),seedId:this.seedIdCfg.expoSeedId,actionId:"exposure",spmId:a.spmId};if(this.fullLinkAndChInfo){var c=a.extra.newChinfo||"",l=a.extra.entityId||a.extra.scm||"";if(c&&l){var u={param5:"newChinfo=".concat(c,"^scm=").concat(l)};e.objectAssign(s,u),e.objectAssign(a.options,u)}}e.objectAssign(s,o);var d=o&&o.force;this.expoObj=this.expoObj||{},d||!1!==this.expoObj[a.spmId]?(this.expoOnce&&(this.expoObj[a.spmId]=!1),this.call("remoteLog",s),this._runAfterFns("expo",a)):console.warn("点位 ".concat(a.spmId," 已经曝光过了"))}}},{key:"calc",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};f("calc 已废弃");var o={param1:this.url,param2:t,param3:n,param4:e.dealExtra(r,this.paramPrefix),seedId:this.seedIdCfg.calcSeedId,actionId:"timestamp"};this.call("remoteLog",o)}},{key:"expoContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.expo(e,"up",r,{param5:"newChinfo=".concat(n,"^scm=").concat(t)})}},{key:"clickContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.click(e,r,{param5:"newChinfo=".concat(n,"^scm=").concat(t)})}}])&&r(a.prototype,l),u&&r(a,u),o}()}));
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],e):(t=t||self).tracertMonitor=e(t.tracertUtil)}(this,(function(util){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(t){for(var e=1;arguments.length>e;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _objectWithoutPropertiesLoose(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;i.length>n;n++)0>e.indexOf(r=i[n])&&(o[r]=t[r]);return o}function _objectWithoutProperties(t,e){if(null==t)return{};var r,n,o=_objectWithoutPropertiesLoose(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;i.length>n;n++)0>e.indexOf(r=i[n])&&Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}var version="0.1.37",errorCodeEnums={JS:1,REQUEST:2,PROMISEREJECTION:3,ASSETS:4};function getResourceErrorSrc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.src||t.href;return"img"===t.tagName.toLowerCase()&&0===e.indexOf("data:")&&(e=e.split(",")[0]),e}function getTime(){var t=new Date,e=function(t){return 10>t?"0".concat(t):"".concat(t)};return"".concat(t.getFullYear(),"-").concat(e(t.getMonth()+1),"-").concat(e(t.getDate())," ").concat(e(t.getHours()),":").concat(e(t.getMinutes()),":").concat(e(t.getSeconds()),":").concat(t.getMilliseconds())}function getXPath(t,e){var r=t.id?"".concat(t.id):"",n=t.className?"".concat(t.className):"",o=t.tagName.toLowerCase(),i=r||n,a=[];r&&a.push('[@id="'.concat(r,'"]')),n&&a.push('[@class="'.concat(n,'"]'));var c="".concat(o).concat(i?a.join(""):"");return t.parentNode&&t.parentNode.tagName&&e-1!=0?"".concat(getXPath(t.parentNode,e-1),">").concat(c):c}function safelyPush(t,e,r){var n=r||20;if(!t||!e)return null;n>=r&&r||(r=n),t.push(e);var o=t.length-n;return o>0&&(t=t.slice(o)),t}function generateIdentifier(t){return[t.code,t.uid,t.page,t.msg||""].join("_")}function getUserId(t){return t&&(t.role_id||t.roleId||t.cUserId||t.backupUserId||t.bucUserId)||""}var objectAssign=util.objectAssign,doc=document,docEl=doc.documentElement,startTime=(new Date).getTime(),fieldLenLimt=660,limitFields=["code","msg"],encodeValue=function(t){return encodeURIComponent(t).replace(/'/g,"%27")};function objToStr(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"^",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=[];if(t instanceof Array)o=t;else if(t instanceof Object){var i=n?encodeValue:function(t){return t};for(e in t)if(t.hasOwnProperty(e)){var a=i(t[e]);o.push("".concat(e,"=").concat(a))}}return o.join(r)}function initSessionId(t){if(!t.sessionId){var e=window.sessionStorage,r=t.sessionIdKey;e||(e={}),e[r]||(e[r]="".concat(util.uuid(),"_").concat(Date.now())),t.set({sessionId:e[r]})}}function getNetwork(){return navigator&&navigator.connection&&navigator.connection.effectiveType?navigator.connection.effectiveType:""}function filterParam(t,e){objectAssign(e,this.mdata||{}),e.title=document.title,e.dom_cnt=document.getElementsByTagName("*").length,e.delay=(new Date).getTime()-startTime,e.scroll_top=docEl.scrollTop+doc.body.scrollTop,e.content_height=Math.max(docEl.clientHeight,docEl.offsetHeight,docEl.scrollHeight),e.last_action=this._lastAction,e.monitorConfigFailed=this._monitorConfigFailed?1:0,e.network=getNetwork(),e.spmId=t;var r=this.refSpm||this.referSPM||"";e.ref=this.refUrl,e.referSPM=r,e.fullURL=this.fullURL||location.href,e.source_appid=this.spmAPos,this._spmId&&(e._spmId=this._spmId),this._refSpm&&(e._refSpm=this._refSpm),this.cOfflineVer&&(e.c_offline_ver=this.cOfflineVer),this.cAppId&&(e.c_app_id=this.cAppId);var n=[version],o=this._v;if(o&&n.push("h5:".concat(o)),e.tracert_ver=n.join(";"),"object"===_typeof(e)){var i=e;for(var a in i)if(i.hasOwnProperty(a)&&"string"==typeof i[a]){0>limitFields.indexOf(a)&&!/^[dmc]\d+$/.test(a)||i[a].length>fieldLenLimt&&(i[a]=i[a].slice(0,fieldLenLimt));var c=i[a].replace(/\s+/g," ");i[a]="fullURL"===a&&c.length>300?c.slice(0,300):c}}return e}function getUA(){return navigator.userAgent?navigator.userAgent.replace(/,/g,"%2C"):""}function packFinalData(t){var e=t.spmId,r=t.seedId,n=t.param4,o=n.__sid||this.sessionId||util.uuid();delete n.__sid;var i=new Date,a=function(t){return 10>t?"0".concat(t):"".concat(t)},c=getUserId(this),s=["D-AE","".concat(i.getFullYear(),"-").concat(a(i.getMonth()+1),"-").concat(a(i.getDate())," ").concat(a(i.getHours()),":").concat(a(i.getMinutes()),":").concat(a(i.getSeconds()),":").concat(i.getMilliseconds()),this.clientId,"","2","",o,c,1e3,r,"H5behavior",this.logLevel,"","","","","","","","","","","","","","".concat(window.innerWidth||"","x").concat(window.innerHeight,"x").concat(window.devicePixelRatio),"","","",getUA(),"","","",objToStr(this.sysInfo),"",""];if(1===n.s3&&1===n.code)s.push(objToStr(n,"^",!0));else{var d=filterParam.call(this,e,n);s.push(objToStr(d,"^",!0))}for(var l=0;s.length>l;l++)"string"==typeof s[l]&&(s[l]=s[l].replace(/,/g,"%2C"));return s}function sendData(t){var e=window.encodeURIComponent;this.debug&&console.log(t),this._httpLog(e(t.join()))}function bridgeLog(t){window.AlipayJSBridge?window.AlipayJSBridge.call("handleLoggingAction",{actionType:"reportEvent",params:{eventId:this.seedIdCfg.exceptionSeedId||this._defaultExceptionSeedId,bizType:"bmmonitor",extData:t||{}}}):this._warn("非容器环境，不能调用 handleLoggingAction")}function remoteLog(t){this.init(),initSessionId(this);var e=t.param4,r=t.spmId;if(window.AlipayJSBridge&&e&&e.code>10){var n=filterParam.call(this,r,e);for(var o in delete n.__sid,n._ua=getUA(),n.spmId=r,n)n.hasOwnProperty(o)&&"string"==typeof n[o]&&(n[o]=encodeValue(n[o]));bridgeLog.call(this,n)}else{var i=packFinalData.call(this,t);sendData.call(this,i)}}function log(t){try{var e=this._preproccess(t);if(!e)return;if(void 0!==e.sampleRate&&Math.random()>e.sampleRate)return void this._warn("当前已设置采样率 ".concat(e.sampleRate,"，未被采集"));this._runBeforeFns("send",e);var r=e.bmAppid||this._bmAppId;remoteLog.call(this,{spmId:this.spmAPos&&this.spmBPos?"".concat(this.spmAPos,".").concat(this.spmBPos):"",seedId:this.seedIdCfg.exceptionSeedId||this._defaultExceptionSeedId,param4:_objectSpread2({pid:this.pid||"",bm_appid:r,bm_sid:this._bmSprintId,env:this._env||""},e)})}catch(t){this._warn("Tracert 异常上报失败:",t)}}function getMonitorConfig(t){for(var e=null,r=0;this._monitorConfigs.length>r;r++)this._monitorConfigs[r].code===t.code&&(e=this._monitorConfigs[r]);return e}function filterOptions(t,e){for(var r={},n=0;e.fields.length>n;n++)r[e.fields[n]]=!0;for(var o in t)!r[o]&&/^[dmc]\d+$/.test(o)&&delete t[o];return t}function preproccess(t){if(!t)return!1;if(1===t.code&&1===t.s3)return t;if("function"==typeof this.beforeLog){var e;try{e=this.beforeLog(t)}catch(t){}if(!1===e)return this._warn("当前由于 beforeLog 返回 false，未被采集"),!1;"object"===_typeof(e)&&(t=e)}for(var r=generateIdentifier(_objectSpread2({},t,{uid:getUserId(this),page:this.fullURL||location.href})),n=!1,o=0;this._trackedLogs.length>o;o++)if(this._trackedLogs[o]===r){n=!0;break}if((null==t.oncePerSession?this.oncePerSession:t.oncePerSession)&&n)this._warn("当前由于 OncePerSession 策略，未被采集");else{if(this._monitorConfigInited||this._monitorConfigFailed){if(this._monitorConfigFailed)return t;if(void 0!==t.bmAppid&&this._bmAppId!==t.bmAppid)return t;var i=getMonitorConfig.call(this,t);return!!i&&(i.isDeleted||!i.isActive?(this._warn("当前监控项已关闭"),!1):(void 0===t.sampleRate&&(t.sampleRate=i.sampleRate),!n&&this._trackedLogs.push(r),filterOptions(t,i)))}safelyPush(this._cacheLogs,t)}}function handleErrorOptions(t,e){var r=t.target||t.srcElement;if(r)if("unhandledrejection"!==t.type){if(r instanceof HTMLElement){var n=getResourceErrorSrc(r),o=r.tagName.toLowerCase(),i=r.alt,a=void 0===i?"":i;e({code:errorCodeEnums.ASSETS,msg:n||"",s1:o,s2:getXPath(r,5),s3:a})}else t.error&&t.error.stack?this.logError(t.error):e({code:errorCodeEnums.JS,msg:t.message,s3:0})}else{var c=t.reason||{};if(c.message&&c.stack)this.logError(c,{code:errorCodeEnums.PROMISEREJECTION});else{var s=c.message||("string"==typeof c?c:JSON.stringify(c));e({code:errorCodeEnums.PROMISEREJECTION,msg:s})}}}function handleErrorOptions$1(t,e){try{handleErrorOptions.call(this,t,e)}catch(t){this._warn("handleErrorOptions failed",t)}}var win=window;function interfaceRegister(t){var e=!1;if("XMLHttpRequest"in win){var r=win.XMLHttpRequest.prototype,n=r.open;r.open=function(t,e){this.__tracertMonitor__={method:t,url:e||"",status_code:null};for(var r=Array(arguments.length),o=0;r.length>o;++o)r[o]=arguments[o];n.apply(this,r)};var o=r.send;r.send=function(r){var n=this;function i(){if(n.__tracertMonitor__&&4===n.readyState)try{var o=n.__tracertMonitor__.url;if(0===n.status)return;var i=o.split("?")[0],a=o.split("?")[1]||"",c="string"==typeof r?r:JSON.stringify(r),s=n.response+"";s.length>2048&&(s="[too large]");if(200>n.status||n.status>299||e){if(i===t.server)return void t._warn("Tracert 上报异常",c);t.logRequestError({type:"http",status:n.status,url:i,method:n.__tracertMonitor__.method,query:a,data:c,response:s,traceId:t.traceId||""})}}catch(e){t._warn("Tracert 接口异常上报失败:",e)}}if("onreadystatechange"in n&&"function"==typeof n.onreadystatechange){var a=n.onreadystatechange;n.onreadystatechange=function(){for(var t=Array(arguments.length),e=0;t.length>e;++e)t[e]=arguments[e];i.apply(this,t),a.apply(this,t)}}else n.onreadystatechange=i;for(var c=Array(arguments.length),s=0;c.length>s;++s)c[s]=arguments[s];return o.apply(this,arguments)}}if("fetch"in win){var i=win.fetch;win.fetch=function(){for(var r=Array(arguments.length),n=0;r.length>n;++n)r[n]=arguments[n];var o="GET";return r[1]&&r[1].method&&(o=r[1].method.toUpperCase()),i.apply(this,r).then((function(n){return new Promise((function(i){try{var a=r[0],c=a.split("?")[0],s=a.split("?")[1]||"",d=r[1]&&r[1].body||"",l="string"==typeof d?d:JSON.stringify(d);n.clone().text().then((function(r){n.ok&&!e||t.logRequestError({type:"http",status:n.status,url:c,method:o,query:s,data:l,response:(r||"").length>2048?"[too large]":r,traceId:t.traceId||""})})).then((function(){i(n)}),(function(t){i(n)}))}catch(t){i(n)}}))}))}}}function _typeof$1(t){return(_typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;e.length>r;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);t.length>e;e++)r[e]=t[e];return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _iterableToArrayLimit(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var checkEnv=function(){var t=window.navigator.userAgent,e="";return!!t.match(/iphone|ipad|iPod/gi)&&(e="iOS"),!!t.match(/android/gi)&&(e="Android"),!!t.match(/Firefox/gi)&&(e="Firefox"),!!t.match(/Chrome/gi)&&(e="Chrome"),!t.match(/Chrome/gi)&&!!t.match(/Safari/gi)&&(e="Safari"),!!t.match(/Opera/gi)&&(e="Opera"),!!t.match(/MSIE/gi)&&(e="IE"),e};function checkAndriodSpecial(){return!0}var generateHandler=function(t){switch(t){case"iOS":return{filter:function(t){return 0>t.indexOf("[native code]")&&t.indexOf("@")>=0}};case"Android":return{filter:function(t,e){return e&&0>t.indexOf("nonymous")&&checkAndriodSpecial()}};default:return{filter:function(){return!0}}}};function safeAdd(t,e){var r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function bitRotateLeft(t,e){return t<<e|t>>>32-e}function md5cmn(t,e,r,n,o,i){return safeAdd(bitRotateLeft(safeAdd(safeAdd(e,t),safeAdd(n,i)),o),r)}function md5ff(t,e,r,n,o,i,a){return md5cmn(e&r|~e&n,t,e,o,i,a)}function md5gg(t,e,r,n,o,i,a){return md5cmn(e&n|r&~n,t,e,o,i,a)}function md5hh(t,e,r,n,o,i,a){return md5cmn(e^r^n,t,e,o,i,a)}function md5ii(t,e,r,n,o,i,a){return md5cmn(r^(e|~n),t,e,o,i,a)}function binlMD5(t,e){var r,n,o,i,a;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var c=1732584193,s=-271733879,d=-1732584194,l=271733878;for(r=0;t.length>r;r+=16)n=c,o=s,i=d,a=l,c=md5ff(c,s,d,l,t[r],7,-680876936),l=md5ff(l,c,s,d,t[r+1],12,-389564586),d=md5ff(d,l,c,s,t[r+2],17,606105819),s=md5ff(s,d,l,c,t[r+3],22,-1044525330),c=md5ff(c,s,d,l,t[r+4],7,-176418897),l=md5ff(l,c,s,d,t[r+5],12,1200080426),d=md5ff(d,l,c,s,t[r+6],17,-1473231341),s=md5ff(s,d,l,c,t[r+7],22,-45705983),c=md5ff(c,s,d,l,t[r+8],7,1770035416),l=md5ff(l,c,s,d,t[r+9],12,-1958414417),d=md5ff(d,l,c,s,t[r+10],17,-42063),s=md5ff(s,d,l,c,t[r+11],22,-1990404162),c=md5ff(c,s,d,l,t[r+12],7,1804603682),l=md5ff(l,c,s,d,t[r+13],12,-40341101),d=md5ff(d,l,c,s,t[r+14],17,-1502002290),c=md5gg(c,s=md5ff(s,d,l,c,t[r+15],22,1236535329),d,l,t[r+1],5,-165796510),l=md5gg(l,c,s,d,t[r+6],9,-1069501632),d=md5gg(d,l,c,s,t[r+11],14,643717713),s=md5gg(s,d,l,c,t[r],20,-373897302),c=md5gg(c,s,d,l,t[r+5],5,-701558691),l=md5gg(l,c,s,d,t[r+10],9,38016083),d=md5gg(d,l,c,s,t[r+15],14,-660478335),s=md5gg(s,d,l,c,t[r+4],20,-405537848),c=md5gg(c,s,d,l,t[r+9],5,568446438),l=md5gg(l,c,s,d,t[r+14],9,-1019803690),d=md5gg(d,l,c,s,t[r+3],14,-187363961),s=md5gg(s,d,l,c,t[r+8],20,1163531501),c=md5gg(c,s,d,l,t[r+13],5,-1444681467),l=md5gg(l,c,s,d,t[r+2],9,-51403784),d=md5gg(d,l,c,s,t[r+7],14,1735328473),c=md5hh(c,s=md5gg(s,d,l,c,t[r+12],20,-1926607734),d,l,t[r+5],4,-378558),l=md5hh(l,c,s,d,t[r+8],11,-2022574463),d=md5hh(d,l,c,s,t[r+11],16,1839030562),s=md5hh(s,d,l,c,t[r+14],23,-35309556),c=md5hh(c,s,d,l,t[r+1],4,-1530992060),l=md5hh(l,c,s,d,t[r+4],11,1272893353),d=md5hh(d,l,c,s,t[r+7],16,-155497632),s=md5hh(s,d,l,c,t[r+10],23,-1094730640),c=md5hh(c,s,d,l,t[r+13],4,681279174),l=md5hh(l,c,s,d,t[r],11,-358537222),d=md5hh(d,l,c,s,t[r+3],16,-722521979),s=md5hh(s,d,l,c,t[r+6],23,76029189),c=md5hh(c,s,d,l,t[r+9],4,-640364487),l=md5hh(l,c,s,d,t[r+12],11,-421815835),d=md5hh(d,l,c,s,t[r+15],16,530742520),c=md5ii(c,s=md5hh(s,d,l,c,t[r+2],23,-995338651),d,l,t[r],6,-198630844),l=md5ii(l,c,s,d,t[r+7],10,1126891415),d=md5ii(d,l,c,s,t[r+14],15,-1416354905),s=md5ii(s,d,l,c,t[r+5],21,-57434055),c=md5ii(c,s,d,l,t[r+12],6,1700485571),l=md5ii(l,c,s,d,t[r+3],10,-1894986606),d=md5ii(d,l,c,s,t[r+10],15,-1051523),s=md5ii(s,d,l,c,t[r+1],21,-2054922799),c=md5ii(c,s,d,l,t[r+8],6,1873313359),l=md5ii(l,c,s,d,t[r+15],10,-30611744),d=md5ii(d,l,c,s,t[r+6],15,-1560198380),s=md5ii(s,d,l,c,t[r+13],21,1309151649),c=md5ii(c,s,d,l,t[r+4],6,-145523070),l=md5ii(l,c,s,d,t[r+11],10,-1120210379),d=md5ii(d,l,c,s,t[r+2],15,718787259),s=md5ii(s,d,l,c,t[r+9],21,-343485551),c=safeAdd(c,n),s=safeAdd(s,o),d=safeAdd(d,i),l=safeAdd(l,a);return[c,s,d,l]}function binl2rstr(t){var e,r="",n=32*t.length;for(e=0;n>e;e+=8)r+=String.fromCharCode(t[e>>5]>>>e%32&255);return r}function rstr2binl(t){var e,r=[];for(r[(t.length>>2)-1]=void 0,e=0;r.length>e;e+=1)r[e]=0;var n=8*t.length;for(e=0;n>e;e+=8)r[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return r}function rstrMD5(t){return binl2rstr(binlMD5(rstr2binl(t),8*t.length))}function rstrHMACMD5(t,e){var r,n,o=rstr2binl(t),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=binlMD5(o,8*t.length)),r=0;16>r;r+=1)i[r]=909522486^o[r],a[r]=1549556828^o[r];return n=binlMD5(i.concat(rstr2binl(e)),512+8*e.length),binl2rstr(binlMD5(a.concat(n),640))}function rstr2hex(t){var e,r,n="";for(r=0;t.length>r;r+=1)e=t.charCodeAt(r),n+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return n}function str2rstrUTF8(t){return unescape(encodeURIComponent(t))}function rawMD5(t){return rstrMD5(str2rstrUTF8(t))}function hexMD5(t){return rstr2hex(rawMD5(t))}function rawHMACMD5(t,e){return rstrHMACMD5(str2rstrUTF8(t),str2rstrUTF8(e))}function hexHMACMD5(t,e){return rstr2hex(rawHMACMD5(t,e))}function md5(t,e,r){return e?r?rawHMACMD5(e,t):hexHMACMD5(e,t):r?rawMD5(t):hexMD5(t)}var ErrorStack=function(){function t(e){_classCallCheck(this,t),this.env=e||checkEnv(),this.stackFilter=generateHandler(this.env).filter}return _createClass(t,[{key:"makeReg",value:function(){switch(this.env){case"iOS":return/(?:\s*)\w+(?=@)|(?:@).*?(?=:\d*:)|(?::)\d*(?=:)|(?::)\d*$/g;default:return null}}},{key:"stackFormatter",value:function(t){var e=t.message,r=[],n="Android"===this.env,o="iOS"===this.env,i=t.stack.split("\n").filter(this.stackFilter);i.shift();var a=i.join("\n"),c=this.makeReg();return c?i.map((function(t){var e=t.match(c);if(e){var i=_slicedToArray(e,4),a=i[0],s=void 0===a?"":a,d=i[1],l=void 0===d?"":d,f=i[2],u=void 0===f?"":f,h=i[3],p=void 0===h?"":h,g=n?s.split(".").reverse()[0]:s,m=o?1:0;r.push("at ".concat(g," (").concat(l.substr(m),":").concat(u.substr(m),":").concat(p.substr(m),")"))}else r.push(t);return null})):r=i,{hash:this.encryptStack(e,r),message:e,stackList:r,stackStr:a}}},{key:"encryptStack",value:function(t,e){var r=[].concat(_toConsumableArray(e.slice(0,6)),_toConsumableArray(e.slice(7,8)),_toConsumableArray(e.slice(9,10)),_toConsumableArray(e.slice(11,12)),_toConsumableArray(e.slice(13,14))).join(";");return md5("".concat(t,":").concat(r))}}]),t}(),STACK_LENGTH_LIMIT=20,ChromeREGEX=/^\s*at .*? ?\(((?:file|https?|blob|chrome-extension|native|eval|<anonymous>).*?)(?::\d+)?(?::\d+)?\)?\s*$/i,GeckoREGEX=/^\s*.*?(?:\(.*?\))?(?:^|@)((?:file|https?|blob|chrome|resource|\[native).*?)(?::\d+)?(?::\d+)?\s*$/i,WinJSREGEX=/^\s*at (?:(?:\[object object\])?.+ )?\(?((?:file|ms-appx|https?|blob):.*?):\d+(?::\d+)?\)?\s*$/i;function parseStack(t){for(var e=t.slice(0,STACK_LENGTH_LIMIT),r=["",""],n={},o=1,i=0;e.length>i;i+=1){var a=ChromeREGEX,c=(e[i]||"").match(a);if(null===c&&(c=(e[i]||"").match(a=GeckoREGEX)),null===c&&(c=(e[i]||"").match(a=WinJSREGEX)),null!==c){var s=c[1],d=n[s];void 0===d&&(n[s]="#".concat(o,"#"),o+=1,d=n[s]),e[i]=e[i].replace(s,d)}}e.length>0&&(r[1]=e.map((function(t){return t.trim()})).join(""));var l="";for(var f in n)n.hasOwnProperty(f)&&(l+="".concat(f,"@").concat(n[f],";"));return l=l.replace(/;$/,""),r[0]=l,r.join("").replace(/\^/g,"").replace(/=/g,"").replace(/,/g,"")}function unParseStack(t){var e=t&&t.split("")||[];if(!e[0]||!e[1])return t;for(var r={},n=e[0].split(";"),o=0;n.length>o;o+=1){var i=n[o]&&n[o].split("@#");r["#".concat(i[1])]=i[0]}return e[1].replace(/#[0-9]+#/g,(function(t){return r[t]||""})).replace(/\u0004/g,"^").replace(/\u0005/g,"=").replace(/\u0006/g,",").split("")}"undefined"==typeof process||_typeof$1(process);var helper={compressStack:function(t){return parseStack(t)},uncompressStack:function(t){return unParseStack(t)}},compressStack=helper.compressStack;function hashDetection(t,e){try{var r=new XMLHttpRequest;r.open("GET","https://dataservice.alipayobjects.com/alertserver/hash/".concat(t),!0),r.send(),r.onreadystatechange=function(){if(4===r.readyState){if(200===r.status||304===r.status)return;e(1)}}}catch(t){this._warn("hash 监测失败",t)}}var es=new ErrorStack;function logError(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=r.code||errorCodeEnums.JS,o="";if(t&&t.stack){var i=es.stackFormatter(t),a=i.hash,c=i.stackList;a&&c&&c.length&&hashDetection(a,(function(){e.log({code:errorCodeEnums.JS,s1:a,s2:compressStack(c),s3:1})})),o=a}this.log(_objectSpread2({code:n,msg:t.message,s10:o},r))}catch(t){this._warn("Tracert 异常上报失败:",t)}}function logHttpError(t){var e=t.status,r=t.url,n=t.method,o=t.query,i=t.data,a=t.response,c=t.traceId,s=t.code,d=_objectWithoutProperties(t,["status","url","method","query","data","response","traceId","code"]),l=_objectSpread2({code:s||2,msg:"".concat(n.toUpperCase()," ").concat(r)},d);e&&(l.s1=e),o&&(l.s2=o),i&&(l.s3=i),a&&(l.s4=a),c&&(l.s5=c),this.log(l)}function logRequestError(t){try{if(!t)return;var e=t.type,r=void 0===e?"http":e;"http"===r&&logHttpError.call(this,t)}catch(t){this._warn("Tracert 接口异常上报失败:",t)}}var win$1=window,metaFieldMap={bm_app_id:"_bmAppId",bm_sprint_id:"_bmSprintId",env:"_env"},context={_monitorInited:!1,_monitorConfigInited:!1,_monitorConfigFailed:!1,_defaultExceptionSeedId:"102023",_bmAppId:"",_bmSprintId:"",_cachedHttpLines:[],_env:"",_cacheLogs:[],_trackedLogs:[],_monitorConfigs:[],_lastAction:"0".concat(getTime(),""),log:log,logError:logError,logRequestError:logRequestError,_preproccess:preproccess,_handleErrorOptions:handleErrorOptions$1,_initException:function(t){if(!this._monitorInited){for(var e=util.nodeListToArray(window.document.getElementsByTagName("meta")),r={},n=0,o=0;e.length>o;o++){var i=e[o],a=util.getAttr(i,"name"),c=util.getAttr(i,"content"),s=metaFieldMap[a];s&&c&&!this[s]&&(r[s]=c,n++)}t.TRACERT_ENV&&(r._env=t.TRACERT_ENV),n&&this.set(r),this._monitorInited=!0}},getErrorEventHandler:function(t){return function(e){t.isErrorHandler=!0,t._handleErrorOptions(e,(function(e){t.log(e)}))}},initMonitorConfigs:function(t){var e=t.monitors,r=void 0===e?[]:e;if(!this._disableInterface)for(var n=0;r.length>n;n++){var o=r[n];if(o.code===errorCodeEnums.REQUEST&&o.isActive&&!o.isDeleted){interfaceRegister(this);break}}this.set({_monitorConfigs:r}),this._monitorConfigInited=!0,this._onMonitorConfigInited()},_onMonitorConfigInited:function(){var t=this._cacheLogs;if(t.length){for(var e=0;t.length>e;e++)this.log(t[e]);this._cacheLogs=[]}},_warn:function(){if("object"===_typeof(win$1)&&win$1.console&&"function"==typeof win$1.console.warn&&this.debug){var t=Array.prototype.slice.call(arguments);win$1.console.warn.apply(null,["[Tracert Debug]".concat(t[0])].concat(t.slice(1)))}},_debug:function(){if("object"===_typeof(win$1)&&win$1.console&&"function"==typeof win$1.console.log&&this.debug){var t=Array.prototype.slice.call(arguments);win$1.console.log.apply(null,["[Tracert Debug]".concat(t[0])].concat(t.slice(1)))}}},win$2=window,doc$1=win$2.document;function register(t){try{if(!doc$1)return t.warn("当前为非 web 环境，不支持报错监听与插件使用"),this;if(t.isErrorHandler)return void t.warn("错误事件已监听");util.addEvent("error",win$2,t.getErrorEventHandler(t)),util.addEvent("unhandledrejection",win$2,t.getErrorEventHandler(t))}catch(e){t.warn("Tracert 加载异常插件失败")}}function errorHandler(t){this._monitorConfigInited=!0,this._monitorConfigFailed=!0,this._onMonitorConfigInited(),this._warn("Tracert 获取服务端配置失败：",t)}function addScript(t){var e=this,r=errorHandler.bind(this),n=document.createElement("script");n.src=t,n.onerror=function(t){t.stopPropagation(),r.call(e,t)},document.head.appendChild(n),setTimeout((function(){e._monitorConfigInited||r.call(e,"超时")}),5e3)}function fetchConfig(Tracert){var onError=errorHandler.bind(Tracert);if(!Tracert._bmAppId)return setTimeout((function(){onError("没有 bmAppid")}));var isPre="pre"===Tracert._env,url="https://render.alipay.com/p/alertserver".concat(isPre?"_pre":"","/").concat(Tracert._bmAppId,"_config/index.js");window.AlipayJSBridge?window.AlipayJSBridge.call("httpRequest",{url:url,method:"GET",contentType:"application/json"},(function(res){if(res&&200===res.status)try{eval(res.data)}catch(t){onError(t)}else onError("未找到配置")})):addScript.call(Tracert,url)}function fetchConfig$1(t){try{fetchConfig(t)}catch(t){errorHandler.call(this)}}function send(t,e){t.postMessage(JSON.stringify(e),"*")}var verifyKey="__TRACERT_MONITOR_verify";function verify(t){var e,r=util.CrossIframe.initIframe();util.addEvent("load",r,(function(){send(e=r.contentWindow,{type:"storage",action:"get",key:verifyKey})})),util.addEvent("message",window,(function(r){try{var n=JSON.parse(r.data);if("getStorage"===n.type&&n.key===verifyKey){var o=JSON.parse(n.value)||{};o[t._bmAppId]=1,e&&send(e,{type:"storage",action:"set",key:verifyKey,value:JSON.stringify(o)})}}catch(t){}}))}function setVerify(t){t._bmAppId?util.load((function(){verify(t),setTimeout((function(){alert("请关闭该页面查看验证结果"),setTimeout((function(){window.parent&&window.parent.close&&window.parent.close()}))}),100)})):alert("未获取到应用ID")}var spliter="",doc$2=document,docEl$1=doc$2.documentElement;function setLastAction(t,e){try{var r=[],n="click"===t.type;r.push(n?1:2);var o=n?"".concat(getXPath(t.target,5)):"";r.push(o),r.push(getTime());var i=n?"".concat(t.x,"x").concat(t.y):"".concat(docEl$1.scrollLeft+doc$2.body.scrollLeft,"x").concat(docEl$1.scrollTop+doc$2.body.scrollTop);r.push(i);var a=t.target&&t.target.innerText,c=a?"".concat(a.slice(0,8)):"";r.push(c),e._lastAction=r.join(spliter)}catch(t){}}function lastAction(t){var e;util.addEvent("scroll",document,(function(r){e||(e=!0,setTimeout((function(){e=!1}),300),setLastAction(r,t))})),util.addEvent("click",document,(function(e){setLastAction(e,t)}))}function getQueries(){for(var t={},e=window.location.search.substring(1).split("&").map((function(t){return t.split("=")})),r=0;e.length>r;r++){var n=e[r];t[n[0]]=n[1]}return t}function handlePreCapture(t){var e=window.g_monitor;if(e){var r=e.listener,n=void 0===r?{}:r,o=e.events,i=void 0===o?[]:o;for(var a in n)n.hasOwnProperty(a)&&(util.removeEvent(a,window,n[a]),delete n[a]);for(var c=0;i.length>c;c++)t._handleErrorOptions(i[c],(function(e){t.log(e)}));e.events=[]}}var throttleWait=0,maxRecordLen=10,cachedHttpLineData=[];function sendHttpRequest(t){try{var e=new XMLHttpRequest;e.open("POST","https://mdap.alipay.com/loggw/dwcookieLogGet.do",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("data=".concat(t,"&time=").concat((new Date).getTime()))}catch(e){try{(new Image).src="".concat(this.server,"?data=").concat(t,"&time=").concat((new Date).getTime())}catch(t){this._warn("Tracert 通过 IMG 上报失败.",t)}}}var sendAll=null;function httpLog(t){0===throttleWait?sendHttpRequest(t):(cachedHttpLineData.push(t),sendAll&&sendAll())}function throttle(t){var e=null;return function(){var r=this,n=arguments;function o(){clearTimeout(e),e=null,t.apply(r,n)}maxRecordLen>cachedHttpLineData.length?e||(e=setTimeout((function(){o()}),throttleWait)):o()}}function getHttpLog(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return throttleWait=t,sendAll=throttle((function(){if(cachedHttpLineData.length){var t=cachedHttpLineData.join("$$");cachedHttpLineData=[],sendHttpRequest(t)}})),httpLog}function getInfoFromBridge(t){try{var e=window.AlipayJSBridge;e.call("getUserInfo",(function(e){t.cUserId=e.userId})),e.call("getStartupParams",(function(e){t.cOfflineVer=e.version,e.version&&(t.cAppId=e.appId)}))}catch(e){setTimeout((function(){t._warn("调用容器接口获取信息失败",e)}))}}function init(t,e){if(!t._monitorInited&&e&&"object"===_typeof(e)){var r=e.autoCapture,n=void 0===r||r,o=e.httpThrottle,i=void 0===o?{}:o;t.set({_bmAppId:e.bmAppid,_bmSprintId:e.bmSprintId,_disableInterface:!!e.disableInterface,oncePerSession:!!e.oncePerSession,beforeLog:e.beforeLog}),t._httpLog=getHttpLog(i.wait||0);var a=getQueries();t._initException(a),fetchConfig$1(t),window.AlipayJSBridge?getInfoFromBridge(t):document.addEventListener("AlipayJSBridgeReady",(function(){getInfoFromBridge(t)}),!1),"1"===a.TRACERT_VERIFY&&setVerify(t),handlePreCapture(t),n&&register(t),lastAction(t)}}window.hashDetection=hashDetection;var index=function(t,e){return t.set(_objectSpread2({},context)),init(t,t.monitorOptions),t.after("start",(function(){init(t,t.monitorOptions)})),t.before("set",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.monitorOptions;init(t,r)})),e(),t};return index}));
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],t):(e=e||self).tracertPluginPerformance=t(e.tracertUtil)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;arguments.length>t;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var a=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t,n;t="undefined"!=typeof self?self:i,n=function(){if("object"==typeof window){var e,t=window,n={0:"navigate",1:"reload",2:"back_forward"},r=["unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart"];return t&&t.performance&&"object"==typeof t.performance?"function"==typeof t.performance.getEntries&&"function"==typeof t.performance.getEntriesByType&&"function"==typeof t.performance.getEntriesByName&&"function"==typeof t.performance.now&&t.performance.timeOrigin?t.performance:e={_entry:function(){for(var e=t.performance.timing,o=e.navigationStart||e.redirectStart||e.fetchStart,i={entryType:"navigation",initiatorType:"navigation",name:t.location.href,startTime:0,duration:e.loadEventEnd?e.loadEventEnd-o:0,redirectCount:t.performance.navigation.redirectCount,type:n[t.performance.navigation.type]},a=0;r.length>a;a++){var c=r[a],f=e[c];i[c]=f?f-o:0}return i}(),timeOrigin:t.performance.timing.navigationStart,getEntries:function(){return[this._entry]},getEntriesByType:function(e){return"navigation"!==e?[]:[this._entry]},getEntriesByName:function(e){return e!==t.location.href?[]:[this._entry]},now:function(){return Date.now()-t.performance.timing.navigationStart}}:e}},e.exports?e.exports=n():t.timing2=n()}));var c=function(e){var t=e.records,n=e.start,r=e.timeout,o=e.load;if(0===t.length)return"number"==typeof r?r:0;"number"==typeof o&&t.forEach((function(e){e.weight=Math.pow(.5,Math.abs(parseFloat(e.t)-o)/1e3)}));var i=t.map((function(e,n){if(0===n)return 0;var r=t[n-1];return e.domCnt===r.domCnt?0:(e.domCnt-r.domCnt)/(e.t-r.t)*("number"==typeof e.weight?e.weight:1)})),a=Math.max.apply(null,i),c=i.indexOf(a);return t[c].t-n},f="number"==typeof __PAINTY_STACK_LIMIT__?__PAINTY_STACK_LIMIT__:100;function u(){return"object"==typeof performance&&"function"==typeof performance.now?performance.now():Date.now()}var d=["connectEnd","connectStart","decodedBodySize","domComplete","domContentLoadedEventEnd","domContentLoadedEventStart","domInteractive","domainLookupEnd","domainLookupStart","duration","encodedBodySize","fetchStart","loadEventEnd","loadEventStart","redirectCount","redirectEnd","redirectStart","requestStart","responseEnd","responseStart","secureConnectionStart","transferSize","type","unloadEventEnd","unloadEventStart","workerStart","firstPaint","firstContentfulPaint","firstMeaningfulPaint"];function s(e,n){if("object"!==t(e)||"function"!=typeof e.getEntriesByType)return[];var r=[],o=e.getEntriesByType("navigation");if(!o||0===o.length)return[];var i=o[0],a=function(e){if("object"!==t(e))return[];var n=e.getEntriesByType("paint"),r={};if(n.length){var o=(n.filter((function(e){return"first-paint"===e.name}))[0]||{}).startTime,i=(n.filter((function(e){return"first-contentful-paint"===e.name}))[0]||{}).startTime;r.firstPaint=parseFloat(o),r.firstContentfulPaint=parseFloat(i)}return r}(e),c={firstMeaningfulPaint:n};return d.forEach((function(e){var t=i[e]||a[e]||c[e];r.push(null==t||"number"==typeof t&&isNaN(t)?"-":"number"==typeof t?parseFloat(t.toFixed(2)):t)})),r}var l=[10240,51200,102400,204800,512e3],m=l.length+1;function p(e){return l.reduce((function(t,n,r){var o=l[r-1]||0,i={name:"imageSizeGroup".concat(r,"Count"),field:"img_".concat(r),val:e.filter((function(e){return n>e.encodedBodySize&&e.encodedBodySize>o})).length};return t.concat(i)}),[]).concat({name:"imageSizeGroup".concat(m,"Count"),field:"img_".concat(m),val:e.filter((function(e){return e.encodedBodySize>l[l.length-1]})).length})}var g=function(e){return"script"===e.initiatorType&&e.name.indexOf(".js")>-1},y=function(e){return"link"===e.initiatorType&&e.name.indexOf(".css")>-1},v=function(e){return"h2"===e.nextHopProtocol},h=function(e){return/^.*font.*\.svg(\?|$|#)/.test(e.name)},b=function(e){return"img"===e.initiatorType||/\.(jpg|jpeg|png|bmp|webp|svg|ico)(\?|$|#)/.test(e.name)&&!h(e)},S=function(e){return"iframe"===e.initiatorType},E=function(e){return"css"===e.initiatorType&&(/\.(ttf|eot|woff)(\?|$|#)/.test(e.name)||h(e))},T=function(e){return e.decodedBodySize>e.encodedBodySize},w=function(e){return e.encodedBodySize>e.transferSize},j=function(e){return e.workerStart},C=function(e){return e.reduce((function(e,t){return e+t.encodedBodySize}),0)};var z=null;function O(t,n){var r={pid:"tracert",msg:t.message,code:n,page:location.href,c1:(t.stack||"").slice(0,500),c2:(t.stack||"").slice(500,1e3),c3:(t.stack||"").slice(1e3,1500)};(new Image).src="//gm.mmstat.com/fsp.1.1?".concat(e.objToStr(r,"&"))}function P(e,r){if("object"===t(r)&&!e.metricsSent)try{var i=r.getEntriesByType("navigation")[0],a=s(r,z),c=function(e,n){if("object"!==t(e))return[];var r=e.getEntriesByType("resource").filter((function(e){return e.startTime&&n>e.startTime}));if(0===r.length)return[];var o=r.filter(g),i=r.filter(y),a=r.filter(b),c=r.filter(E),f=r.filter(S);return{metrics:[{name:"resourceCount",field:"rcnt",val:r.length},{name:"resourceSize",field:"rsize",val:C(r)},{name:"jsCount",field:"jscnt",val:o.length},{name:"jsSize",field:"jssize",val:C(o)},{name:"cssCount",field:"csscnt",val:i.length},{name:"cssSize",field:"csssize",val:C(i)},{name:"imageCount",field:"imgcnt",val:a.length},{name:"imageSize",field:"imgsize",val:C(a)},{name:"fontCount",field:"fontcnt",val:c.length},{name:"fontSize",field:"fontsize",val:C(c)},{name:"iframeCount",field:"iframecnt",val:f.length},{name:"iframeSize",field:"iframesize",val:C(f)},{name:"Http2EnabledCount",field:"h2cnt",val:r.filter(v).length},{name:"compressedResourceCount",field:"crcnt",val:r.filter(T).length},{name:"cachedResourceCount",field:"carcnt",val:r.filter(w).length},{name:"serviceWorkerResourceCount",field:"swrcnt",val:r.filter(j).length}],imageGroupMetrics:p(a)}}(r,i.duration),f=function(e,n){return"object"!==t(e)?[]:e.getEntriesByType("resource").filter((function(e){return["xmlhttprequest","fetch"].indexOf(e.initiatorType)>-1&&n>=e.startTime})).map((function(e){return[e.name.split("?")[0],e.startTime,e.transferSize,Math.round(e.responseStart-e.startTime),e.duration]}))}(r,i.duration);e.send(e.seedIdCfg.perfSeedId,o({nav:a.join("_")},(c.metrics||[]).reduce((function(e,t){return o({},e,n({},t.field,Math.round(t.val)))}),{}),{img_group:(c.imageGroupMetrics||[]).map((function(e){return e.val})).join("_"),network:navigator.connection&&navigator.connection.effectiveType||"-",partial:0===i.duration?1:0,ajax:f.map((function(e){return e.join("-")})).join("_"),title:document.title,visible:document.hidden?0:1})),e.metricsSent=!0}catch(e){O(e,12)}}function B(e){if("object"!==t(a))return e;try{!function(e,t){if("object"==typeof window&&"object"==typeof a){"function"==typeof e&&(t=e);var n=[],r=function e(){if("function"==typeof MutationObserver){var t=new MutationObserver((function(){n.push({t:u(),domCnt:document.getElementsByTagName("*").length}),n.length===f&&i()}));return t.observe(document,{childList:!0,subtree:!0}),t.disconnect.bind(t)}var r=setTimeout((function(){n.push({t:u(),domCnt:document.getElementsByTagName("*").length}),n.length===f?i():e()}),200);return function(){clearTimeout(r)}}();if("number"==typeof e)setTimeout(i,e);else{var o=!!navigator.userAgent.match(/iPhone|iPad|iPod/i);window.addEventListener(o?"pagehide":"beforeunload",i)}}function i(){if(r(),"object"==typeof a&&"function"==typeof a.getEntriesByType){var o=a.getEntriesByType("navigation");if(o&&o.length){var i=o[0];t(c({records:n,start:i.startTime,timeout:e,load:i.duration}))}}}}((function(e){z=e})),"function"==typeof a.setResourceTimingBufferSize&&a.setResourceTimingBufferSize(500);var n=!!navigator.userAgent.match(/iPhone|iPad|iPod/i);window.addEventListener(n?"pagehide":"beforeunload",P.bind(null,e,a))}catch(e){O(e,11)}return e}return function(e,t){return B(e),t(),e}}));
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],t):(e=e||self).tracertPluginClickAndExpo=t(e.tracertUtil)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}function l(e,t){return window.getComputedStyle(e,t)}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;n>o;){var i=t[o];if(e.call(r,i,o,t))return i;o++}},configurable:!0,writable:!0});var s=["deer-analysis-render-container","mocha"],d=[200,50],f=["svg","i","p","iframe","pre"],h=["label","input","button","img","iframe"],p=["svg","iframe","form","table"],v=["ul","header","section","article","aside"];function m(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}function g(e){if(Object&&Object.values)return Object.values(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function y(e,t){var n=m(e);if(0!==n.length){for(var r=0;n.length>r;r++)if(5>=Math.abs(n[r]-t))return void e[n[r]]++;e[t]=1}else e[t]=1}function b(e,t){if(!e||!e.children)return[];var n=[].slice.call(e.children)||[];return t?n.filter(t):n}function w(e){var t=e.tagName.toLowerCase();return"div"===t||"span"===t?"span":t}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=b(e,(function(e){return 8!==e.nodeType})),r=n.length;if("ul"===e.tagName.toLowerCase())return!0;if(1>=r&&t>r)return!1;if(r>100)return!1;for(var o="",i=!0,a={},c={},u={},l=0,s=0;r>s;s++){var d=n[s],f=w(d);if(-1!==h.indexOf(f))return!1;if(d.offsetWidth>400&&d.offsetHeight>400)return!1;(16>d.offsetWidth||16>d.offsetHeight)&&l++;var p=Math.max(5,d.offsetWidth);y(a,p);var v=Math.max(5,d.offsetHeight);y(c,v);for(var x=0;d.classList.length>x;x++){var k=d.classList[x];u[k]=(u[k]||0)+1}if(i=o?o===f:i,o=f,!i)return!1}return i&&r/2>l&&-1!==g(u).indexOf(r)&&2>=m(a).length&&m(c).length<=r/2}function k(e){var t={};if(!e.attributes)return{};for(var n=0;e.attributes.length>n;n++){var r=e.attributes[n];t[r.name]=r.value}return t}function T(e){for(;e&&e.childNodes&&e.childNodes.length;){var t=[].slice.call(e.childNodes);if(t.find((function(e){return 3===e.nodeType})))return!0;e=t.filter((function(e){return!!e.tagName})).sort((function(e,t){return 24>e.offsetWidth?1:e.offsetLeft-t.offsetLeft}))[0]}return!!e&&!![].slice.call(e.childNodes||[]).find((function(e){return 3===e.nodeType}))}for(var S=["div","span","a","p","button","ul","li","ol","img","h1","h2","h3","h4","h5","h6","form"],O={},N=0;16>N;N++)O[S[N]]=N;function C(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:">",n=e.split(t);return Array.isArray(n)?n:[n]}(e,">").map((function(e){var t=e.split(":"),n=t[0],r=t[1],o=O.hasOwnProperty(n)?"".concat(O[n].toString(16)):n,i=r?r.replace(/nth-child\((\d+)\)/g,(function(e,t){return"".concat(t)})).replace(/nth-of-type\((\d+)\)/g,(function(e,t){return"t".concat(t)})):"";return"".concat(o).concat(i?"".concat("`").concat(i):"")})).join(">")}function j(e){var t=e.indexOf("\n");return-1!==t&&(e=e.substring(0,t)),e.trim().substring(0,15)}function E(e){if(!e||5===e.nodeType)return"";if(3===e.nodeType)return window.Text&&e instanceof Text?e.wholeText:e;if(!function(e){try{return e instanceof HTMLElement}catch(n){return"object"===t(e)&&1===e.nodeType&&"object"===t(e.style)&&"object"===t(e.ownerDocument)}}(e))return"";switch(e.tagName.toLowerCase()){case"img":return"img:".concat(e.src);case"canvas":return"canvas"}var n=function(e){return e.childNodes||[]}(e),r=b(e),o=k(e);return 0===n.length||function(e){for(var t=0;e.length>t;t++)if(3===e[t].nodeType)return!0;return!1}(n)||0===r.length?e.innerText||o.placeholder||o.alt||l(e,":before").content||l(e,":after").content:E(r[0])}function I(e){var t=E(e);if(t&&"string"==typeof t)return j(t.replace(/\s/g,""));if(!e||b(e).length>3)return"";var n=e.innerText;return n?j(n):3>b(e.parentNode).length?j(I(e.parentNode)):""}function L(e){var t,n=b(e);if(!n||!n.length)return I(e);if(1===n.length)return j(L(n[0]));for(;(t=b(e))&&t.length;)return j(I(e=[].slice.call(t).sort((function(e,t){return 24>e.offsetWidth?1:e.offsetLeft-t.offsetLeft}))[0]));return""}function P(e){var t=l(e);return!t||("SCRIPT"===e.tagName||"none"===t.display||"relative"===t.position&&null===e.offsetParent||"absolute"===t.position&&(5>Math.abs(parseFloat(t.left)+e.offsetWidth)||5>Math.abs(parseFloat(t.top)+e.offsetHeight))||5>e.offsetWidth||5>e.offsetHeight)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(0===t)return!1;var n=b(e);if(0===n.length)return e.clientHeight>d;for(var r=0;n.length>r;r++){var o=n[r],i=l(o);if(("absolute"===i.position||i.float)&&o.clientHeight>50)return!0;if(A(o,t-1))return!0}return!1}function H(e){var t=e.getAttribute("id");return t&&t.substring(0,10)}function D(e){return e.classList&&e.classList.length?".".concat([].slice.call(e.classList,0,2).join(".")):""}function W(e){return e.id?H(e):D(e)}function _(e){return e.offsetWidth*e.offsetHeight}function M(e){var t=b(e);if(2>t.length||t.length>3)return!1;if(x(e,2))return!1;var n=e.offsetWidth,r=t[0],o=r.offsetWidth,i=r.offsetHeight,a=parseInt(l(r).lineHeight,10)||16;return o>=200&&o>=.9*n&&((!i||i>=a&&4*a>=i)&&!!T(r))}function R(e){var t=e;if(t.__possibleBlock)return!0;if("a"===e.tagName.toLowerCase())return!1;if(function(e){return e.id&&-1!==s.indexOf(e.id)}(t))return!1;if(x(t))return!1;var n=b(t);return!(!n||!n.length)&&(t.offsetWidth>=200&&t.offsetHeight>=50)}function B(e){var t=b(e);if(t.length>200)return!0;for(var n=0;t.length>n;n++)if(k(t[n]).hasOwnProperty("contenteditable"))return!0;return!1}function U(e){var t,n=e.tagName.toLowerCase(),r=e.parentNode;if(x(e.parentNode)&&r.children&&r.children.length){for(var o=0,i=0;r.children.length>i;i++){var a=r.children[i];if(a.tagName.toLowerCase()===n&&o++,a===e)break}return"".concat(n,":nth-of-type(").concat(o,")")}for(var c=0;r.children.length>c;c++)if(r.children[c]===e){t=c+1;break}return"".concat(n,":nth-child(").concat(t,")")}function q(e){if(!e)return!1;var t=window.getComputedStyle(e);return"BODY"!==e.tagName&&"fixed"===t.position&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e)return!1;var n=e.getBoundingClientRect(),r=n.top+n.height/2,o=window.innerHeight/2,i=50>Math.abs(r-o),a=(n.right-n.left)/2,c=window.innerWidth/2,u=50>Math.abs(a-c);return 1===t?i||u:i&&u}(e)&&function(e){if(!e)return!1;var t=window.getComputedStyle(e);return 50>Math.abs(e.offsetWidth-window.innerWidth)&&50>Math.abs(e.offsetHeight-window.innerHeight)&&("fixed"===t.position||e.offsetParent===document.body)}(e)}function F(e){var t=e.getBoundingClientRect();return 50>=Math.abs(t.width-window.innerWidth)&&(120>=t.height&&t.y<=t.height)}function J(e){var t=e.getBoundingClientRect();return 50>=Math.abs(t.width-window.innerWidth)&&(120>=t.height&&Math.abs(t.bottom-(e.offsetParent||document.body).offsetHeight)<=50)}window.getNodeText=I,window.getFirstNodeText=E,window.getBlockTitle=L,window.possibleBlock=R,window.possibleHeadedBlock=M;var V=["data-node-selector","data-block-selector"];function G(e,t){var n=2>=arguments.length||void 0===arguments[2]||arguments[2],r=t||document.body;if(e===r||e===document.body)return"body";if(n)for(var o=0;2>o;o++)if(e&&e[V[o]])return e[V[o]];var i=e,a=[];do{a.unshift(U(i))}while(i.parentNode&&i.parentNode!==document.body&&i.parentNode!==r&&(i=i.parentNode));return a.join(">")}window._getSelector=G,window._isModal=q;var $={};function Y(e){var t=1>=arguments.length||void 0===arguments[1]||arguments[1];return e.map((function(e){var n=e.node,r=e.selector||G(n,document.body,t);return n["data-block-selector"]=r,{block:n,selector:C(r)}}))}function z(e,t){var n=document.querySelector(e);if(!n||!function(e,t){if(e.contains&&"function"==typeof e.contains)return e.contains(t);var n=t;do{if(e===n)return!0}while(n=n&&n.parentNode);return!1}(n,t)){var r=$[e];if(r){var o=G(r);return r["data-block-selector"]=o,$[o]=r,r}return null}return n}function K(e){var t,n=(t=window.visualViewport)?[t.offsetLeft,t.offsetTop,t.width,t.height]:[0,0,window.innerWidth,window.innerHeight],r=n[1],o=n[0]+n[3],i=e.getBoundingClientRect(),a=i.top,c=i.bottom,u=i.height;return r>=a&&c>=o||a>=r&&o>=c||a>=r&&o-a>=Math.min(300,u/2)||o>=c&&c-r>=Math.min(300,u/2)}function Q(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{time:0,cnt:0},r=n.time,o=void 0===r?0:r,i=n.cnt,a=void 0===i?0:i,c={};if(!t)return c;var u=t.exposedTime+o,l=t.exposedCnt+a;return t.empty()&&document.body.contains(t.dom)?c[C(G(t.dom))]={time:u,cnt:l,title:t.title,type:t.type,id:H(t.dom),cls:D(t.dom)}:e.objectAssign(c,t.children.reduce((function(t,n){return e.objectAssign(t,Q(n,{time:u,cnt:l}))}),c)),c}var X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,r=arguments.length>1?arguments[1]:void 0;n(this,e),this.dom=document.body,this.children=[],this.selector="",this.lastExposingTime=0,this.exposedTime=0,this.exposedCnt=0,this.title="",this.type="",this.dom=t,this.type=r,this.title=L(t),this.expo()}return o(e,[{key:"visible",value:function(){return!!this.dom&&(!P(this.dom)&&K(this.dom))}},{key:"pause",value:function(){this.empty()?this.unexposed(!0):[].concat(this.children.filter((function(e){return e.pause()})))}},{key:"expo",value:function(){if(!this.empty())return[].concat(this.children.filter((function(e){return e.expo()})));var e=this.dom;return this.visible()?(this.exposed(),[e]):(this.unexposed(),[])}},{key:"getExposed",value:function(e){return Q(this,e)}},{key:"exposed",value:function(){return this.lastExposingTime?this.exposedTime+=Date.now()-this.lastExposingTime:this.exposedCnt++,this.lastExposingTime=Date.now(),this.exposedTime}},{key:"unexposed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.lastExposingTime){var t=Date.now()-this.lastExposingTime;(e||t>500)&&(this.exposedTime+=t)}return this.lastExposingTime=0,this.exposedTime}},{key:"empty",value:function(){return!this.children.length}},{key:"update",value:function(e){var t=this;e.forEach((function(e){return t.insert(e.node,e.type)})),Y(e,!1)}},{key:"contains",value:function(e){return this.dom!==e&&this.dom.contains(e)}},{key:"insert",value:function(t,n){var r=this;if(this.children=this.children.filter((function(e){return r.contains(e.dom)})),!this.children.find((function(e){return e.dom===t}))){var o=this.children.find((function(e){return e.contains(t)}));o?o.insert(t,n):this.children.push(new e(t,n))}}}]),e}();function Z(){return new X}var ee=e.addEvent,te=e.debounce,ne=e.storage,re=e.getAttr;function oe(e){for(var t,n=[],r=[],o=0;e.length>o;o++){var i=e[o];i&&((t=i).id&&-1!==s.indexOf(t.id)||-1!==f.indexOf(t.tagName.toLowerCase())||P(i)?r.push(i):n.push(i))}return{ordered:n,disorderd:r}}function ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return[];for(var n=[],r=[],o=oe(e),i=o.ordered,a=o.disorderd,c=0;a.length>c;c++){var u=a[c];A(u)&&(u.__possibleBlock=!0,i.push(u))}i.sort((function(e,t){return _(e)-_(t)}));for(var l=0;i.length>l;l++){var s=i[l],d=b(s);if(re(s,"data-aspm"))n=n.concat({node:s,type:"spm",selector:re(s,"data-aspm")});else if(s&&s.tagName&&-1!==p.indexOf(s.tagName.toLowerCase()))n=n.concat([{node:s,type:"short"}]);else if(B(s))n=n.concat([{node:s,type:"ugc"}]);else if(x(s))n=n.concat([{node:t[0],type:"list"}]);else if(q(s))n=n.concat([{node:s,type:"modal"}]);else if(F(s))n=n.concat([{node:s,type:"header"}]);else if(J(s))n=n.concat([{node:s,type:"footer"}]);else{if(M(s)){var f=function(){var e=ie(d,[s].concat(t)),r=[],o=[];return e.forEach((function(e){"pattern"===e.type?r.push(e):o.push(e)})),n=n.concat(r&&r.length?r.concat(o):[{node:s,type:"pattern"}]),"continue"}();if("continue"===f)continue}if(s.offsetWidth>document.body.offsetWidth)n=n.concat(ie(d,[s].concat(t)));else if(R(s)){if(1===d.length){var h=ie(d,[s].concat(t),!0);n=n.concat(h&&h.length?h:[{node:s,type:"hoist"}]);continue}var v=ie(d,[s].concat(t),!0);v&&v.length?n=n.concat(v):r.push({node:s,type:"stashed"})}else r.push({node:s,type:"stashed"})}}if(n.length>1){for(var m=0,g=t[0]||e[0],y=0;n.length>y;y++)if("list"===n[y].type&&m++,n[y].node===t[0]){if(g.__possibleBlock){n=n.concat([{node:g.parentNode,type:"hoist"}]);break}return[{node:g,type:"merge"}]}if(m>=n.length/2)return[{node:g,type:"hoist"}]}return r.length&&(n=i.length/2>n.length?[{node:t[0]||e[0],type:"end"}]:n.concat(r)),n}window._pickLayout=ie;var ae=function(){function e(t){var r=this;n(this,e),this.layout={},this.expoTree=null,this.paused=!1,this.pause=function(e){e.target!==window&&e.target!==document||r.paused||(r.expoTree.pause(),r.paused=!0)},this.resume=function(){r.paused&&(r.expoTree.expo(),r.paused=!1)},this.restore=function(){var e=r.tracert,t=ne.get("exposed",{},!0);if(t){var n=t.split("|"),o=n[0],i=n[1];try{var a=decodeURIComponent(o),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2500,n=[];for(var r in e)if(e.hasOwnProperty(r)){var o=e[r],i=o.time,a=o.cnt,c=o.type,u=o.id,l=o.cls;n.push({time:i,text:[r,i,"",a,c,u,l].join("")})}for(var s=n.sort((function(e,t){return t.time-e.time})),d=[],f=t,h=0;s.length>h;h++){var p=s[h],v=p.text,m=void 0===v?"":v;if(m.length>f)break;f-=m.length,d.push(m)}return d.join("")}(JSON.parse(i));a===r.tracert.refUrl&&e.after("start",(function(){e.call("expo","deer_expo","",{expo:c})}))}catch(e){}}},this.timeout=null,this.timeoutLog=function(){r.log(),r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout((function(){return r.log()}),500)},this.log=function(){r.paused||(r.cacheLayout(),r.expoTree.empty()||(r.expoTree.expo(),ne.set("exposed","".concat(encodeURIComponent(location.href),"|").concat(JSON.stringify(Q(r.expoTree))))))},this.tracert=t,this.expoTree=Z(),this.events()}return o(e,[{key:"events",value:function(){var e=this;ee("blur",window,this.pause),ee("focus",window,this.resume),ee("visibilitychange",document,(function(t){"hidden"===document.visibilityState?e.pause(t):"visible"===document.visibilityState&&e.resume()})),ee("scroll",window,te((function(){return e.log()}),200)),ee("beforeunload",window,(function(){e.expoTree.expo();var t=Q(e.expoTree);ne.set("exposed","".concat(encodeURIComponent(location.href),"|").concat(JSON.stringify(t)))})),this.tracert.before("logPv",(function(){e.restore(),e.expoTree.expo();var t=Q(e.expoTree);ne.set("exposed","".concat(encodeURIComponent(location.href),"|").concat(JSON.stringify(t))),$={},e.expoTree=Z(),e.timeoutLog()}))}},{key:"cacheLayout",value:function(){var e=ie([document.body]);return this.expoTree.update(e),this.layout}},{key:"get",value:function(){return this.layout}}]),e}(),ce=e.strToObj;window.isList=x;var ue=document&&document.body?.5*document.body.scrollWidth:0;function le(e){var t=e;if(e instanceof SVGElement&&"svg"!==e.tagName.toLowerCase())try{return le(e.ownerSVGElement)}catch(e){return console.debug("Failed to get ownerSVGElement"),{node:parent,type:5}}var n=[];do{if(e.id&&-1!==s.indexOf(e.id))return null;var r=k(e);if(e["data-block"]&&e["data-node-selector"])return{node:e,type:"CACHED",nodeSelector:e["data-node-selector"]};if(r["data-aspm"])break;if(r["data-aspm-click"])return{node:e,nodeSelector:"".concat(r["data-aspm-click"]),spm:!0,type:0};if("a"===e.tagName.toLowerCase())return{node:e,type:1};if(-1===h.indexOf(e.tagName.toLowerCase())){var o=l(e).cursor||"default";n.push({node:e,type:3,cursor:o})}else n.push({node:e,type:2})}while(e.parentNode&&e.parentNode!==document.body&&(e=e.parentNode));for(var i=0;n.length>i;i++){var a=n[i],c=a.type;if(2===c)return{node:a.node,type:c}}var u,d,f,p=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return null;if(!n||!n.length)return null;if(n.length>t.length-r)return null;var o=Array.isArray(n[0])?n[0]:[n[0]];return o.find((function(e){return t[r].cursor===e}))?1===n.length?0===r?null:t[r-1].node:e(t,n.slice(1),r+1):e(t,n,r+1)}(n,["pointer",["default","auto"]]);return p?{node:p,type:3}:(d=(u=t).offsetWidth,f=u.offsetHeight,-1!==v.indexOf(u.tagName.toLowerCase())||256>d*f||Math.max(d,f)>ue||!T(u)&&!l(u).backgroundImage?null:{node:t,type:4})}function se(e,t,n){var r=t.block,o=t.blockSelector,i=n.node,a=n.nodeSelector,c=n.nodeType,u=n.clickDom,s="";r&&(s=L(r),a=a||G(i,r));var d=I(e),f=u&&u.getAttribute?u.getAttribute("data-aspm-param"):"";return function(e){var t=e.dom,n=e.extraParams,r=e.block,o=e.blockSelector,i=e.blockTitle,a=e.blockId,c=e.node,u=e.nodeId,l=e.nodeSelector,s=e.nodeText,d=e.clickText,f=o||G(r);if(r&&(r["data-block-selector"]=f,$[o]=r),c){c["data-block"]=f;var h=l||G(c,r);c["data-node-selector"]=h,$[h]=c}return{dom:t,extraParams:n,node:l||G(c),nodeText:s,nodeId:u,block:(o||G(r)).replace(/\[data-aspm="([\w-]+)"\]/g,(function(e,t){return t})),blockTitle:i,blockId:a,clickText:d}}({dom:e,extraParams:ce(f),clickDom:u,node:i,nodeSelector:a,nodeMeta:{id:W(i),type:c,err:4===i.type&&"pointer"!==l(i).cursor},nodeId:W(i),nodeText:encodeURIComponent(d),block:r,blockTitle:encodeURIComponent(s),blockSelector:o,blockMeta:r?{id:W(r)}:null,clickText:encodeURIComponent(d)})}function de(e){if(!e||e===document.body)return null;var t=le(e);if(!t)return null;var n=t.node,r=t.type,o=t.node;if("CACHED"===r){var i=n["data-block"],a=z(i,n);if(a)return se(e,{block:a,blockSelector:i},{node:n,nodeSelector:t.nodeSelector,clickDom:o})}var c=t.nodeSelector;if(0===r&&-1!==c.indexOf(".")){var u=c.split("."),l=u[0],s=u[1];return se(e,{block:document.querySelector('[data-aspm="'.concat(l,'"]')),blockSelector:l},{node:n,nodeSelector:s,nodeType:r,clickDom:o})}for(var d=n,f=!1,h="",p=[];d&&d.parentNode&&d.parentNode!==document.body;){var v=d=d.parentNode,m=k(d);if(m["data-aspm"]){f=!0,h='[data-aspm="'.concat(m["data-aspm"],'"]');break}p.unshift(v)}if(f)return se(e,{block:d,blockSelector:h},{node:n,nodeSelector:c,nodeType:r,clickDom:o});for(;d=p.pop();)if(d["data-block-selector"]){var g=d["data-block-selector"],y=z(g,d);if(!y)continue;return se(e,{block:y,blockSelector:g},{node:n,nodeSelector:c||G(n,y),clickDom:o})}var b=function(e){for(var t=e,n=[t];t.parentNode&&t.parentNode!==document.body;){var r=t.parentNode;n.push(r),t=r}return n}(e),w=function(e,t){for(var n=t.length;n>0;n--)for(var r=t[n],o=0;e.length>o;o++){var i=e[o].block;if(i===r)return i}return!1}(Y(ie([document.body])),b);return w?se(e,{block:w,blockSelector:G(w)},{node:n,nodeSelector:c||G(n,w),clickDom:o}):null}var fe,he,pe,ve,me=window,ge="nameStorage:",ye=/^([^=]+)(?:=(.*))?$/,be=encodeURIComponent,we=decodeURIComponent,xe={},ke={};function Te(){var e,t=[],n=!0;for(var r in xe)xe.hasOwnProperty(r)&&(n=!1,e=xe[r]||"",t.push(be(r)+"="+be(e)));me.name=n?fe:ge+be(fe)+"?"+t.join("&")}!function(e){if(e&&0===e.indexOf(ge)){var t=e.split(/[:?]/);t.shift(),fe=we(t.shift())||"";for(var n,r,o,i=t.join("").split("&"),a=0,c=i.length;c>a;a++)(n=i[a].match(ye))&&n[1]&&(r=we(n[1]),o=we(n[2])||"",xe[r]=o)}else fe=e||""}(me.name),ke.setItem=function(e,t){e&&void 0!==t&&(xe[e]=t+"",Te())},ke.getItem=function(e){return xe.hasOwnProperty(e)?xe[e]:null},ke.removeItem=function(e){xe.hasOwnProperty(e)&&(xe[e]=null,delete xe[e],Te())},ke.clear=function(){xe={},Te()},ke.valueOf=function(){return xe},ke.toString=function(){var e=me.name;return 0===e.indexOf(ge)?e:ge+e},pe="beforeunload",ve=function(){Te()},(he=me)&&(he.addEventListener?he.addEventListener(pe,ve,!1):he.attachEvent&&he.attachEvent("on"+pe,(function(e){ve.call(he,e)}))),me.nameStorage=ke;var Se=ke,Oe=e.url,Ne="https://render.alipay.com/p/s/deer-analysis-render/index.js?_t=".concat(Date.now()),Ce="https://render.alipay.com/p/s/deer-analysis-render/index.css?_t=".concat(Date.now()),je=[];function Ee(t){if(t){var n=t.getAttribute("data-extra-spm");if(!n)return;var r=function(e){return function(t){t&&e&&(t.extraSpmIdSet||(t.extraSpmIdSet={}),e.split(",").forEach((function(e){t.extraSpmIdSet[e]=!0})))}}(n);e.addEvent("click",t,r),je.push([t,r])}}function Ie(t){t.refreshExtraClickListeners=function(){je.forEach((function(t){var n=c(t,2);e.removeEvent("click",n[0],n[1])})),je=[];for(var t=document.querySelectorAll("[data-extra-spm]"),n=0;t.length>n;n++)Ee(t[n])},t.refreshExtraClickListeners()}var Le=e.addEvent,Pe=e.inIframe;return function(t,n){var r,o=t;if(Pe()||!window.getComputedStyle||!document.body.classList)return n(),o;function c(n){r||(r=new ae(t,{layout:n}),t.set({_expo:r}),e.load((function(){if(function(e){if(!e)return{};var t=e.split("&");if(!t.length)return{};for(var n={},r=0;t.length>r;r++){var o=(t[r]||"").split("=");n[o[0]]=o[1]||""}return n}(Oe.parse(location.href).query).deer_tracert_token||Se.getItem("deer_tracert_token")){var e=document.createElement("script");e.type="text/javascript",e.src="".concat(Ne),document.getElementsByTagName("HEAD").item(0).appendChild(e);var t=document.createElement("link");t.href=Ce,t.rel="stylesheet",t.type="text/css",document.getElementsByTagName("HEAD").item(0).appendChild(t)}})))}return t._layout?c(t._layout):t.before("set",(function(e){e.hasOwnProperty("_layout")&&c(e._layout)})),Le("click",document.body,(function(e){var t=de(e.target);t&&setTimeout((function(){var n=e.extraSpmIdSet,r=n?Object.keys(n):[],c=t.node,u=t.nodeText,l=t.nodeId,s=t.block,d=t.blockTitle,f=t.blockId,h=t.extraParams;c&&s&&o.after("start",(function(){o.call("click","".concat(C(s),".").concat(C(c)),function(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({nodeText:u,nodeId:l,blockTitle:d,blockId:f,extraSpmIds:r},h))}))}),0)})),Ie(o),n(),o}}));
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],t):(e=e||self).tracertPluginClientSession=t(e.tracertUtil)}(this,(function(e){"use strict";var t=e.Cookies,i=e.uuid,n="".concat(e.cookiesPrefix,"_SESSION");function r(){var e=t.get(n)||i();return t.set(n,e,{expires:new Date((new Date).getTime()+18e5),cookie:!0}),e}var o=e.objectAssign;return function(e,n){var a=e;return r(),a.before("logPv",(function(e){var n=function(e){var n={domain:document.domain&&-1!==document.domain.indexOf(".alipay.com")?".alipay.com":null,cookie:!0,expires:new Date((new Date).getTime()+18e5)},r=function(e,i,r){return t.set("tree",[e,i,r].join(""),n),{_trid:i,_trll:r}},o=i();if(!e)return{};var a=t.get("tree",n,!0);if(!a)return r(e,o,1);var u=a.split(""),c=u[0],f=u[1],s=u[2];return c!==e?r(c,o,1):r(c,f,parseInt(s,10)+1)}(a.spmAPos),u=r();e.__sid=u,o(e,n)})),n(),a}}));
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],e):(t=t||self).tracertPluginFullfillRef=e(t.tracertUtil)}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var r=0;e.length>r;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=t.addEvent,n=t.storage,a=t.nodeListToArray,i=t.getAttr,c=t.url,l=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tracert=e,this.isAlipayDomain=document.domain&&-1!==document.domain.indexOf(".alipay.com"),this.cookiesDomain=this.isAlipayDomain?".alipay.com":null,this.tracert.before("logPv",(function(t){t=t||{};var e=r.get(),o=r.getMetaSpmId();if(o&&r.tracert.set({_spmId:o}),e&&e.metaSpmId&&(t._refSpm=e.metaSpmId,r.tracert.set({_refSpm:t._refSpm})),r.tracert.refUrl&&"-"!==r.tracert.refUrl){var n={},a={};try{if(n=c.parse(r.tracert.url),a=c.parse(r.tracert.refUrl),n.host===a.host)return void r.tracert.set({referSPM:"".concat(r.tracert.spmAPos,".").concat(r.tracert.spmBPos)})}catch(t){}e&&(r.tracert.set({refUrl:e.fullUrl}),r.tracert.referSPM||r.tracert.set({referSPM:e.refSpm}))}})),o("click",window.document.body,(function(t){r.cache(t.target)}))}var l,f,s;return l=t,(f=[{key:"getMetaSpmId",value:function(){for(var t=a(window.document.getElementsByTagName("meta")),e="",r=0;t.length>r;r++){var o=t[r],n=i(o,"name"),c=i(o,"content");if(c&&n)switch(n){case"pagename":e=c}}return e?"".concat(this.tracert.spmAPos,".").concat(encodeURIComponent(e)):e}},{key:"cache",value:function(){var t=this.tracert.fullURL||"";t.length>150&&(t=this.tracert.url);var e=[t,"".concat(this.tracert.spmAPos,".").concat(this.tracert.spmBPos),this.getMetaSpmId()];n.set("fullfill_ref",e.join(""),{domain:this.cookiesDomain,cookie:!0})}},{key:"get",value:function(){var t=n.get("fullfill_ref",{domain:this.cookiesDomain},!0);if(!t)return null;var r=t.split(""),o=r[0],a=r[1],i=r[2],l=c.parse(this.tracert.refUrl),f=c.parse(o);return"object"!==e(l)||"object"!==e(f)?null:l.host===f.host?{fullUrl:o,refSpm:a,metaSpmId:i}:null}}])&&r(l.prototype,f),s&&r(l,s),t}();return function(t,e){var r=t,o=new l(r);return r.set({fullfillRef:o}),e(),r}}));
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],e):(t=t||self).tracertPluginTimeOnPage=e(t.tracertUtil)}(this,(function(t){"use strict";function e(t,e){for(var n=0;e.length>n;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=t.addEvent,i=t.storage,r=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pause=function(t){t.target===window&&(n.paused=!0,n._time_consumed+=Date.now()-n._start_timestamp)},this.resume=function(){n.paused&&(n._start_timestamp=Date.now())},this.cache=function(){var t=location.href,e=n.gettimeConsuming();i.set("residual","".concat(encodeURIComponent(t),"|").concat(e))},this._tracert_inst=e,this.paused=!1,this.start(),this.bindEventListeners()}var r,s,a;return r=t,(s=[{key:"start",value:function(){this._start_timestamp=Date.now(),this._time_consumed=0,this.lastClickEle=null,this.lastClickText=""}},{key:"bindEventListeners",value:function(){n("blur",window,this.pause),n("focus",window,this.resume),n("beforeunload",window,this.cache)}},{key:"gettimeConsuming",value:function(){return this.paused?this._time_consumed:this._time_consumed+(Date.now()-this._start_timestamp)}},{key:"getTime",value:function(){var t=i.get("residual",{},!0);if(!t)return null;var e=t.split("|"),n=e[0],r=e[1];try{if(decodeURIComponent(n)===this._tracert_inst.refUrl)return r}catch(t){return null}return null}}])&&e(r.prototype,s),a&&e(r,a),t}();return function(t,e){var n=t;n.before("logPv",(function(t){var e,i=n.timeConsuming.getTime();i&&(t._consume=i),t._title=(e=document.title).length>20?"".concat(e.substring(0,10)).concat(e.substring(e.length-10),"|").concat(e.length-20):e,n.timeConsuming.cache(),n.timeConsuming.start()}));var i=new r(n);return n.set({timeConsuming:i}),e(),n}}));
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],t):(e=e||self).tracertPluginLayout=t(e.tracertUtil)}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var i=e.addEvent,o=e.storage;function a(e){return e.length>30?e.substr(0,30):e}function c(e){return e===document.body?"body":e.className?".".concat(a(e.className)):a(e.nodeName.toLowerCase())}function f(e){var t;e=e||[];for(var n=0;e.length>n;n++){var r=e[n];r.isLeaf||(r.children&&!(r=f(r.children))||t&&t.area>=r.area||(t=r))}return t}function u(e){e=e||[];for(var t,n,r,i=[],o=0;e.length>o;o++)n=void 0,r=void 0,n=(t=e[o]).offsetWidth,r=t.offsetHeight,"none"!==t.style.display&&Math.min(n,r)>=20&&Math.max(n,r)>=200&&t.children&&t.children.length>0&&i.push(e[o]);return i}function l(e){for(var t=e.node;;){var n=u(t.children),r=n.length;if(r>1)return n.map((function(e){return{node:e,area:e.offsetWidth*e.offsetHeight}}));if(1!==r)return null;t=n[0]}}function h(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=document.body,n=[{node:t,area:t.offsetWidth*t.offsetHeight}],r=1;;){var i=f(n);if(!i)break;var o=l(i);if(o?r-1+o.length>e?(i.children=o.splice(0,e-r+1),r=e):(i.children=o,r+=o.length-1):i.isLeaf=!0,r>=e)break}return n}var s=function(){function e(n){var r=this;t(this,e),this.tracert=n,n.before("logPv",(function(e){var t=r.get();t&&(e._layout=t)})),this.cache(),i("click",document.body,(function(){r.cache()})),i("unload",window,(function(){r.cache()}))}return r(e,[{key:"getLayout",value:function(){return h(1/0)}},{key:"cache",value:function(){if(!this.cached){var e=h();o.set("layout","".concat(location.href,"|").concat(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=n||[];return t.forEach((function(t){var n="".concat(r,"").concat(c(t.node));i.push(n),t&&t.children&&e(t.children,i,r+1)})),n?null:i.join("")}(e))),this.cached=!0}}},{key:"get",value:function(){this.cached=void 0;var e=o.get("layout",{},!0);if(!e)return null;var t=e.split("|");return t[0]===this.tracert.refUrl?t[1]:null}}]),e}(),d=e.addEvent,v=e.storage,g=function(){function e(n){var r=this;t(this,e),this.tracert=n,this.tracert.before("logPv",(function(e){var t=r.get();t&&(e._clickReferer=t)})),d("click",document.body,(function(e){r.cache(e.target)}))}return r(e,[{key:"cache",value:function(e){var t=this.getText(e),n=this.getSectionHead(e),r="";n&&(r=this.getSectionTitle(n)),v.set("clickReferer","".concat(location.href,"").concat(this.format(t),"").concat(this.format(r)))}},{key:"get",value:function(){var e=v.get("clickReferer",{},!0);if(!e)return null;var t=e.split(""),n=t[2];return t[0]===this.tracert.refUrl?"".concat(t[1],"").concat(n):null}},{key:"getSectionTitle",value:function(e){for(;e&&e.children&&e.children.length;)e=[].slice.call(e.children).sort((function(e,t){return 24>e.offsetWidth?1:e.offsetLeft-t.offsetLeft}))[0];return this.getText(e)}},{key:"getSectionHead",value:function(e){for(;e.parentNode;){var t=e,n=e=e.parentNode,r=n.offsetWidth;if(r>=200&&r<document.body.offsetWidth){var i=n.children;if(i&&i.length){var o=i.length;if(o>=2&&3>=o&&i[0]!==t){var a=i[0],c=a.offsetWidth,f=a.offsetHeight;if(!(200>c||.9*r>c||14>f||f>60))return a}}}}return null}},{key:"getText",value:function(e){if(this.isTooManyChildren(e,3))return"";var t=e.innerText;if(!t){var n=e.parentNode;this.isTooManyChildren(n,3)||(t=n.innerText)}return t}},{key:"format",value:function(e){if(!e)return"";var t=e.length;return t>20?"...".concat(e.substr(t-20)):e}},{key:"isTooManyChildren",value:function(e,t){var n=0,r=function(e){var i=e.children;if(i){var o=i.length;if(t>=(n+=o)&&o)for(var a=0;o>a;a++)if(r(i[a]),n>t)return}};return r(e),n>t}}]),e}();return function(e,t){var n=e,r=new s(n),i=new g(n);return n.set({_layout:r,clickReferer:i}),t(),n}}));
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],e):(t=t||self).tracertPluginAutoLogPv=e(t.tracertUtil)}(this,(function(t){"use strict";function e(t,e){for(var r=0;e.length>r;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=t.url;function n(){return document.body&&document.body.innerText&&document.body.innerText.length||0}var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tracert=e,this.curUrl=e.get("fullURL");var i=this.curUrlObj=r.parse(this.curUrl);this.curDocLen=n();var a=i.hash,s=this.isAnchor(a);s||(i.hash=this.cleanHash(a)),this.tracert.call("set",{url:s?this.curUrl.split(/\?|#/)[0]:i.format()}),this.start()}var i,a,s;return i=t,(a=[{key:"start",value:function(){var t=this;this.interval=setTimeout((function(){t.check(),t.start()}),500)}},{key:"stop",value:function(){clearTimeout(this.interval),this.interval=void 0}},{key:"check",value:function(){var t=window.location.href,e=this.diff(t);e&&(this.tracert.call("set",{refUrl:this.curUrl,referSPM:"".concat(this.tracert.spmAPos,".").concat(this.tracert.spmBPos),url:e.isHashSinglePage?e.format():t.split(/\?|#/)[0],fullURL:t}),this.tracert.call("logPv",e.isHashSinglePage?{}:{_nohash:1})),this.curUrl=t,this.curUrlObj=e||r.parse(t),this.curDocLen=n()}},{key:"diff",value:function(t){if(t===this.curUrl)return!1;var e=r.parse(t),n=e.hash,i=this.curUrlObj;return e.path===i.path&&function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return JSON.stringify(t)===JSON.stringify(e)}(e.query,i.query)?n!==i.hash&&!this.isAnchor(n)&&(e.isHashSinglePage=!0,e.hash=this.cleanHash(e.hash),e):e}},{key:"isAnchor",value:function(t){return!(!t||"#"===t)&&"/"!==(t=t.substr(1))[0]&&document.getElementById(decodeURI(t))&&5>Math.abs(this.curDocLen-n())}},{key:"cleanHash",value:function(t){if(!t)return t;var e=t.indexOf("?");return-1!==e&&(t=t.substr(0,e)),t}}])&&e(i.prototype,a),s&&e(i,s),t}();return function(t,e){var r=t,n=new i(r);return r.set({monitor:n}),r.before("set",(function(t){if(t&&t.pathName&&r.spmAPos){n.stop();var e=t.pathName,i=r.pathName;r._spmId&&(r._refSpm=r._spmId),r.fullURL=location.href,r.url=location.href.split(/\?|#|;jsessionid=/)[0],r._spmId="".concat(r.spmAPos,".").concat(encodeURIComponent(e)),i&&(r.refUrl=r.url,r.referSPM="".concat(r.spmAPos,".").concat(r.spmBPos),r.call("logPv"))}})),e(),r}}));
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@alipay/tracert-util")):"function"==typeof define&&define.dmmma?define(["@alipay/tracert-util"],t):(e=e||self).tracertWeb=t(e.tracertUtil)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}var c,f,u,d,l=window,h="nameStorage:",p=/^([^=]+)(?:=(.*))?$/,g=encodeURIComponent,m=decodeURIComponent,y={},v={};function I(){var e,t=[],n=!0;for(var r in y)y.hasOwnProperty(r)&&(n=!1,e=y[r]||"",t.push(g(r)+"="+g(e)));l.name=n?c:h+g(c)+"?"+t.join("&")}!function(e){if(e&&0===e.indexOf(h)){var t=e.split(/[:?]/);t.shift(),c=m(t.shift())||"";for(var n,r,i,o=t.join("").split("&"),a=0,s=o.length;s>a;a++)(n=o[a].match(p))&&n[1]&&(r=m(n[1]),i=m(n[2])||"",y[r]=i)}else c=e||""}(l.name),v.setItem=function(e,t){e&&void 0!==t&&(y[e]=t+"",I())},v.getItem=function(e){return y.hasOwnProperty(e)?y[e]:null},v.removeItem=function(e){y.hasOwnProperty(e)&&(y[e]=null,delete y[e],I())},v.clear=function(){y={},I()},v.valueOf=function(){return y},v.toString=function(){var e=l.name;return 0===e.indexOf(h)?e:h+e},u="beforeunload",d=function(){I()},(f=l)&&(f.addEventListener?f.addEventListener(u,d,!1):f.attachEvent&&f.attachEvent("on"+u,(function(e){d.call(f,e)}))),l.nameStorage=v;var b=v,_=e.load,S=e.CrossIframe;function w(e,t){e.postMessage(JSON.stringify(t),"*")}var P=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.iframe=null,this.iframeLoaded=!1,this.userId=null,this.pending=!1,this.queue=[],this.cachedQuery=[],_((function(){window.addEventListener("message",(function(e){return t.receive(e)}),!1),t.iframe=S.initIframe()}))}var t,r,i;return t=e,(r=[{key:"receive",value:function(e){var t;if(e.data){try{t=JSON.parse(e.data)}catch(e){return}if(t.type)switch(t.type){case"getStorage":for(this.pending=!1;this.queue.length;)(0,this.queue[0])(t),this.queue.shift();break;case"iframOnload":this.iframeOnLoad()}}}},{key:"iframeOnLoad",value:function(){this.iframeLoaded=!0,this.executeCachedQuery()}},{key:"executeCachedQuery",value:function(){if(this.cachedQuery.length)for(var e=0;this.cachedQuery.length>e;e++){var t=a(this.cachedQuery[e]),n=t[0],r=t.slice(1);this[n].apply(this,r)}}},{key:"set",value:function(e,t,n){this.iframeLoaded?(n&&"function"==typeof n&&this.queue.push(n),w(this.iframe.contentWindow,{type:"storage",action:"set",key:e,value:t})):this.cachedQuery.push(["set",e,t,n])}},{key:"get",value:function(e,t){var n=this.iframe.contentWindow;this.iframeLoaded?(t&&"function"==typeof t&&this.queue.push(t),this.pending||(w(n,{type:"storage",action:"get",key:e}),this.pending=!0)):this.cachedQuery.push(["get",e,t])}}])&&n(t.prototype,r),i&&n(t,i),e}(),O=e.isWechat,j={_guid:function(){return e.uuid()},_initCrossStorage:function(e){O()||(e._crossStorage=new P)},_initClientId:function(e){var t=window.localStorage,n=e.sessionIdKey;t&&(t[n]||(t[n]="".concat(this._guid(),"_").concat(Date.now())),e.set({clientId:t[n]}),e._crossStorage&&e._crossStorage.get(n,(function(r){var i=r.value;if(n===r.key){var o=i||t[n];e.set({clientId:o}),i||e._crossStorage.set(n,o),t[n]!==o&&(t[n]=o)}})))},_initChInfo:function(t){if(!t.chInfo){var n=e.getValue("chInfo")||e.getValue("chinfo");n&&t.set({chInfo:n})}},_initVerify:function(t){var n=e.getValue("tracertTaskId"),r=e.getValue("tracertVerifyServer");n&&t.set({taskId:n}),r&&t.set({verifyServer:r})},_initPageId:function(e){if(!e.get("pageId")){var t="".concat(e.spmAPos,".").concat(e.spmBPos,"_").concat(this._guid(),"_").concat(Date.now());e.set({pageId:t})}},_initFromUrlOrStorage:function(t,n){for(var r=0;n.length>r;r++){var i=n[r],o=e.getValue(i)||b.getItem("".concat("TRACERT_REF_").concat(i));if(o){var a={};a[i]=o,t.set(a)}}},_initRefs:function(e){this._initFromUrlOrStorage(e,["referSPM"]),e.ignoreNameStorage||(window.onunload=function(){var t=e.spmAPos&&e.spmBPos?[e.spmAPos,e.spmBPos].join("."):"";t&&b.setItem("".concat("TRACERT_REF_","referSPM"),t)})}},k=e.objectAssign,A={eventType:"click",fullURL:location.href,server:"https://mdap.alipay.com/loggw/dwcookieLogGet.do",refUrl:document.referrer||"-",seedIdCfg:{pageSeedId:"10012",clkSeedId:"10032",expoSeedId:"10022",perfSeedId:"10074",exceptionSeedId:"102022"},verifyServer:"https://log.alipay.com/realTimeNonNativeLogCheck/uploadLog.json",init:function(){this._calledInited||(j._initCrossStorage(this),j._initClientId(this),j._initChInfo(this),j._initPageId(this),j._initRefs(this),j._initVerify(this),this._calledInited=!0)},_logPv:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.spmAPos&&this.spmBPos?[this.spmAPos,this.spmBPos].join("."):"",r=document.getElementsByTagName("meta")["extra-page-spm"],i=[null].concat(r&&r.content?r.content.split(","):[]);i.forEach((function(r){e.call("remoteLog",{seedId:e.seedIdCfg.pageSeedId,spmId:n,extraPageId:r,param4:o({},t)})}))},remoteLog:function(e){this.init();var t=this._packFinalData(e);this._send(t)},_packFinalData:function(n){var r=n.spmId,i=n.seedId,o=n.param4,a=n.extraPageId;k(o,this.mdata||{});var s=o.__sid||j._guid();if(delete o.__sid,o.spmId=r,i!==this.seedIdCfg.pageSeedId){var c=this.spmAPos,f=this.spmBPos;switch(r.split(".").length){case 1:if(""===r)break;o.spmId=[c,f,r].join(".");break;case 2:o.spmId=[c,f,r].join(".")}}var u=new Date,d=this.refSpm||this.referSPM||"";o.ref=this.refUrl,o.referSPM=d,this.chInfo&&(o.chInfo=this.chInfo),o.fullURL=this.fullURL,o.source_appid=this.spmAPos,this._spmId&&(o._spmId=this._spmId),this._refSpm&&(o._refSpm=this._refSpm),this.platformType&&(o.mPlatformType=this.platformType),this.bucUserId&&(o.__BUC_ID=this.bucUserId);var l=this.userType;if(!l)switch(l="3",this.spmAPos){case"a385":case"a369":l="2";break;case"a316":l="1"}o.__ut=l;var h=this.role_id||this.roleId||this.backupUserId||(o&&"3"===o.__ut?this.bucUserId:"")||"";if(o.clientID=this.clientId,"object"===t(o)){var p=o;for(var g in p)if(p.hasOwnProperty(g)&&"string"==typeof p[g]){var m=p[g].replace(/,/g,"%2C").replace(/\s+/g," ").replace(/=/g,"%3D");p[g]="fullURL"===g&&m.length>300?m.slice(0,300):m}}for(var y=function(e){return 10>e?"0".concat(e):"".concat(e)},v=["D-AE","".concat(u.getFullYear(),"-").concat(y(u.getMonth()+1),"-").concat(y(u.getDate())," ").concat(y(u.getHours()),":").concat(y(u.getMinutes()),":").concat(y(u.getSeconds()),":").concat(u.getMilliseconds()),this.clientID,"","2","",s,h,1e3,i,this.bizType,this.logLevel,a||this.pageId,"","","","","","","","","","","","","".concat(window.innerWidth||"","x").concat(window.innerHeight,"x").concat(window.devicePixelRatio),"","","",navigator.userAgent,"","","",e.objToStr(this.sysInfo),"","",e.objToStr(o)],I=0;v.length>I;I++)"string"==typeof v[I]&&(v[I]=v[I].replace(/,/g,"%2C"));return v},_send:function(t){e.request({tracert:this,type:"http",data:t})},send:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"10032",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this._runBeforeFns("send",t),this.remoteLog({spmId:n||"".concat(this.spmAPos,".").concat(this.spmBPos),seedId:e,param4:t})}},C=e.objectAssign;return function(e,t){var n=e;return C(n,A),t(),n}}));
 'use strict'; var win = window; if (!win.Tracert || win.Tracert._isInit || win.Tracert._isRenderInit) { var Tracert = new win.tracertCore(); Tracert.set({ userType: '2', spmAPos: 'a385', spmBPos: 'b4693' }); Tracert.setSysInfo({ v: '058f5' }); var plugins = [ win.tracertWeb, win.tracertMonitor, win.tracertPluginPerformance, win.tracertPluginClickAndExpo, win.tracertPluginClientSession, win.tracertPluginFullfillRef, win.tracertPluginTimeOnPage, win.tracertPluginLayout, win.tracertPluginAutoLogPv ]; Tracert.loadPlugins(plugins); win.Tracert = Tracert; } 